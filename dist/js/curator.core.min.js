!function(t,e){if("function"==typeof define&&define.amd){var i=function(){var i=[].slice.call(arguments);return i.unshift(t),e.apply(this,i)};define(["jquery","curator"],i)}else"object"==typeof exports?module.exports=e(t,require("jquery")):t.Curator=e(t,t.jQuery||t.Zepto)}(this,function(t,e){if(void 0==e)return window.alert("jQuery not found\n\nThe Curator Widget is running in dependency mode - this requires jQuery of Zepto. Try disabling DEPENDENCY MODE in the Admin on the Publish page."),!1;var i=function(t,e,i,s){if(!Array.isArray(t))throw new TypeError("array is not a Array");var o=t.length;i=parseInt(i,10)||0,s=void 0===s?o:parseInt(s,10)||0;var r,n;for(r=i<0?Math.max(o+i,0):Math.min(i,o),n=s<0?Math.max(o+s,0):Math.min(s,o);r<n;r++)t[r]=e;return t};Array.prototype.fill||(Array.prototype.fill=function(t,e,s){return i(this,t,e,s)}),function(t){function e(e,r){function n(t,e){return function(){c||(r(void 0===p.status?t:p.status,0===p.status?"Error":p.response||p.responseText||e,p),c=!0)}}var a=e.headers||{},u=e.body,l=e.method||(u?"POST":"GET"),c=!1,p=i(e.cors);p.open(l,e.url,!0);var h=p.onload=n(200);p.onreadystatechange=function(){4===p.readyState&&h()},p.onerror=n(null,"Error"),p.ontimeout=n(null,"Timeout"),p.onabort=n(null,"Abort"),u&&(s(a,"X-Requested-With","XMLHttpRequest"),t.FormData&&u instanceof t.FormData||s(a,"Content-Type","application/x-www-form-urlencoded"));for(var d,f=0,g=o.length;f<g;f++)d=o[f],void 0!==e[d]&&(p[d]=e[d]);for(var A in a)p.setRequestHeader(A,a[A]);return p.send(u),p}function i(e){return e&&t.XDomainRequest&&!/MSIE 1/.test(navigator.userAgent)?new XDomainRequest:t.XMLHttpRequest?new XMLHttpRequest:void 0}function s(t,e,i){t[e]=t[e]||i}var o=["responseType","withCredentials","timeout","onprogress"];t.nanoajax=e}(this),function(t,e){var i=function(t,e,i){var s;return function(){function o(){i||t.apply(r,n),s=null}var r=this,n=arguments;s?clearTimeout(s):i&&t.apply(r,n),s=setTimeout(o,e||150)}};t.fn[e]=function(t){return t?this.bind("resize",i(t)):this.trigger(e)}}(e,"smartresize"),function(){function t(t,e){return e=e||"","string"!=typeof t&&(t.global&&e.indexOf("g")<0&&(e+="g"),t.ignoreCase&&e.indexOf("i")<0&&(e+="i"),t.multiline&&e.indexOf("m")<0&&(e+="m"),t=t.source),new RegExp(t.replace(/#\{(\w+)\}/g,function(t,e){var i=s.txt.regexen[e]||"";return"string"!=typeof i&&(i=i.source),i}),e)}function e(t,e){return t.replace(/#\{(\w+)\}/g,function(t,i){return e[i]||""})}function i(t,e,i){var s=String.fromCharCode(e);return i!==e&&(s+="-"+String.fromCharCode(i)),t.push(s),t}var s={};s.txt={},s.txt.regexen={};var o={"&":"&amp;",">":"&gt;","<":"&lt;",'"':"&quot;","'":"&#39;"};s.txt.htmlEscape=function(t){return t&&t.replace(/[&"'><]/g,function(t){return o[t]})},s.txt.regexSupplant=t,s.txt.stringSupplant=e,s.txt.addCharsToCharClass=i;var r=/A-Za-z\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0370-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u048A-\u052F\u0531-\u0556\u0559\u0561-\u0587\u05D0-\u05EA\u05F0-\u05F2\u0620-\u064A\u066E\u066F\u0671-\u06D3\u06D5\u06E5\u06E6\u06EE\u06EF\u06FA-\u06FC\u06FF\u0710\u0712-\u072F\u074D-\u07A5\u07B1\u07CA-\u07EA\u07F4\u07F5\u07FA\u0800-\u0815\u081A\u0824\u0828\u0840-\u0858\u08A0-\u08B2\u0904-\u0939\u093D\u0950\u0958-\u0961\u0971-\u0980\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BD\u09CE\u09DC\u09DD\u09DF-\u09E1\u09F0\u09F1\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A59-\u0A5C\u0A5E\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABD\u0AD0\u0AE0\u0AE1\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3D\u0B5C\u0B5D\u0B5F-\u0B61\u0B71\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BD0\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D\u0C58\u0C59\u0C60\u0C61\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD\u0CDE\u0CE0\u0CE1\u0CF1\u0CF2\u0D05-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D\u0D4E\u0D60\u0D61\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0E01-\u0E30\u0E32\u0E33\u0E40-\u0E46\u0E81\u0E82\u0E84\u0E87\u0E88\u0E8A\u0E8D\u0E94-\u0E97\u0E99-\u0E9F\u0EA1-\u0EA3\u0EA5\u0EA7\u0EAA\u0EAB\u0EAD-\u0EB0\u0EB2\u0EB3\u0EBD\u0EC0-\u0EC4\u0EC6\u0EDC-\u0EDF\u0F00\u0F40-\u0F47\u0F49-\u0F6C\u0F88-\u0F8C\u1000-\u102A\u103F\u1050-\u1055\u105A-\u105D\u1061\u1065\u1066\u106E-\u1070\u1075-\u1081\u108E\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u1380-\u138F\u13A0-\u13F4\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16F1-\u16F8\u1700-\u170C\u170E-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17D7\u17DC\u1820-\u1877\u1880-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191E\u1950-\u196D\u1970-\u1974\u1980-\u19AB\u19C1-\u19C7\u1A00-\u1A16\u1A20-\u1A54\u1AA7\u1B05-\u1B33\u1B45-\u1B4B\u1B83-\u1BA0\u1BAE\u1BAF\u1BBA-\u1BE5\u1C00-\u1C23\u1C4D-\u1C4F\u1C5A-\u1C7D\u1CE9-\u1CEC\u1CEE-\u1CF1\u1CF5\u1CF6\u1D00-\u1DBF\u1E00-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u2071\u207F\u2090-\u209C\u2102\u2107\u210A-\u2113\u2115\u2119-\u211D\u2124\u2126\u2128\u212A-\u212D\u212F-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2183\u2184\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CEE\u2CF2\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2E2F\u3005\u3006\u3031-\u3035\u303B\u303C\u3041-\u3096\u309D-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312D\u3131-\u318E\u31A0-\u31BA\u31F0-\u31FF\u3400-\u4DB5\u4E00-\u9FCC\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA61F\uA62A\uA62B\uA640-\uA66E\uA67F-\uA69D\uA6A0-\uA6E5\uA717-\uA71F\uA722-\uA788\uA78B-\uA78E\uA790-\uA7AD\uA7B0\uA7B1\uA7F7-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA840-\uA873\uA882-\uA8B3\uA8F2-\uA8F7\uA8FB\uA90A-\uA925\uA930-\uA946\uA960-\uA97C\uA984-\uA9B2\uA9CF\uA9E0-\uA9E4\uA9E6-\uA9EF\uA9FA-\uA9FE\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA60-\uAA76\uAA7A\uAA7E-\uAAAF\uAAB1\uAAB5\uAAB6\uAAB9-\uAABD\uAAC0\uAAC2\uAADB-\uAADD\uAAE0-\uAAEA\uAAF2-\uAAF4\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB5F\uAB64\uAB65\uABC0-\uABE2\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D\uFB1F-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE70-\uFE74\uFE76-\uFEFC\uFF21-\uFF3A\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC\u0300-\u036F\u0483-\u0489\u0591-\u05BD\u05BF\u05C1\u05C2\u05C4\u05C5\u05C7\u0610-\u061A\u064B-\u065F\u0670\u06D6-\u06DC\u06DF-\u06E4\u06E7\u06E8\u06EA-\u06ED\u0711\u0730-\u074A\u07A6-\u07B0\u07EB-\u07F3\u0816-\u0819\u081B-\u0823\u0825-\u0827\u0829-\u082D\u0859-\u085B\u08E4-\u0903\u093A-\u093C\u093E-\u094F\u0951-\u0957\u0962\u0963\u0981-\u0983\u09BC\u09BE-\u09C4\u09C7\u09C8\u09CB-\u09CD\u09D7\u09E2\u09E3\u0A01-\u0A03\u0A3C\u0A3E-\u0A42\u0A47\u0A48\u0A4B-\u0A4D\u0A51\u0A70\u0A71\u0A75\u0A81-\u0A83\u0ABC\u0ABE-\u0AC5\u0AC7-\u0AC9\u0ACB-\u0ACD\u0AE2\u0AE3\u0B01-\u0B03\u0B3C\u0B3E-\u0B44\u0B47\u0B48\u0B4B-\u0B4D\u0B56\u0B57\u0B62\u0B63\u0B82\u0BBE-\u0BC2\u0BC6-\u0BC8\u0BCA-\u0BCD\u0BD7\u0C00-\u0C03\u0C3E-\u0C44\u0C46-\u0C48\u0C4A-\u0C4D\u0C55\u0C56\u0C62\u0C63\u0C81-\u0C83\u0CBC\u0CBE-\u0CC4\u0CC6-\u0CC8\u0CCA-\u0CCD\u0CD5\u0CD6\u0CE2\u0CE3\u0D01-\u0D03\u0D3E-\u0D44\u0D46-\u0D48\u0D4A-\u0D4D\u0D57\u0D62\u0D63\u0D82\u0D83\u0DCA\u0DCF-\u0DD4\u0DD6\u0DD8-\u0DDF\u0DF2\u0DF3\u0E31\u0E34-\u0E3A\u0E47-\u0E4E\u0EB1\u0EB4-\u0EB9\u0EBB\u0EBC\u0EC8-\u0ECD\u0F18\u0F19\u0F35\u0F37\u0F39\u0F3E\u0F3F\u0F71-\u0F84\u0F86\u0F87\u0F8D-\u0F97\u0F99-\u0FBC\u0FC6\u102B-\u103E\u1056-\u1059\u105E-\u1060\u1062-\u1064\u1067-\u106D\u1071-\u1074\u1082-\u108D\u108F\u109A-\u109D\u135D-\u135F\u1712-\u1714\u1732-\u1734\u1752\u1753\u1772\u1773\u17B4-\u17D3\u17DD\u180B-\u180D\u18A9\u1920-\u192B\u1930-\u193B\u19B0-\u19C0\u19C8\u19C9\u1A17-\u1A1B\u1A55-\u1A5E\u1A60-\u1A7C\u1A7F\u1AB0-\u1ABE\u1B00-\u1B04\u1B34-\u1B44\u1B6B-\u1B73\u1B80-\u1B82\u1BA1-\u1BAD\u1BE6-\u1BF3\u1C24-\u1C37\u1CD0-\u1CD2\u1CD4-\u1CE8\u1CED\u1CF2-\u1CF4\u1CF8\u1CF9\u1DC0-\u1DF5\u1DFC-\u1DFF\u20D0-\u20F0\u2CEF-\u2CF1\u2D7F\u2DE0-\u2DFF\u302A-\u302F\u3099\u309A\uA66F-\uA672\uA674-\uA67D\uA69F\uA6F0\uA6F1\uA802\uA806\uA80B\uA823-\uA827\uA880\uA881\uA8B4-\uA8C4\uA8E0-\uA8F1\uA926-\uA92D\uA947-\uA953\uA980-\uA983\uA9B3-\uA9C0\uA9E5\uAA29-\uAA36\uAA43\uAA4C\uAA4D\uAA7B-\uAA7D\uAAB0\uAAB2-\uAAB4\uAAB7\uAAB8\uAABE\uAABF\uAAC1\uAAEB-\uAAEF\uAAF5\uAAF6\uABE3-\uABEA\uABEC\uABED\uFB1E\uFE00-\uFE0F\uFE20-\uFE2D/.source,n=/0-9\u0660-\u0669\u06F0-\u06F9\u07C0-\u07C9\u0966-\u096F\u09E6-\u09EF\u0A66-\u0A6F\u0AE6-\u0AEF\u0B66-\u0B6F\u0BE6-\u0BEF\u0C66-\u0C6F\u0CE6-\u0CEF\u0D66-\u0D6F\u0DE6-\u0DEF\u0E50-\u0E59\u0ED0-\u0ED9\u0F20-\u0F29\u1040-\u1049\u1090-\u1099\u17E0-\u17E9\u1810-\u1819\u1946-\u194F\u19D0-\u19D9\u1A80-\u1A89\u1A90-\u1A99\u1B50-\u1B59\u1BB0-\u1BB9\u1C40-\u1C49\u1C50-\u1C59\uA620-\uA629\uA8D0-\uA8D9\uA900-\uA909\uA9D0-\uA9D9\uA9F0-\uA9F9\uAA50-\uAA59\uABF0-\uABF9\uFF10-\uFF19/.source,a=/_\u200c\u200d\ua67e\u05be\u05f3\u05f4\uff5e\u301c\u309b\u309c\u30a0\u30fb\u3003\u0f0b\u0f0c\u00b7/.source,u=/\.-/.source;s.txt.regexen.hashSigns=/[#ï¼ƒ]/,s.txt.regexen.hashtagAlpha=new RegExp("["+r+"]"),s.txt.regexen.hashtagAlphaNumeric=new RegExp("["+r+n+a+u+"]"),s.txt.regexen.endHashtagMatch=t(/^(?:#{hashSigns}|:\/\/)/),s.txt.regexen.hashtagBoundary=new RegExp("(?:^|$|[^&"+r+n+a+"])"),s.txt.regexen.validHashtag=t(/[#]+(#{hashtagAlphaNumeric}*)/gi),window.twttr=s}();var s={debug:!1,SOURCE_TYPES:["twitter","instagram"],log:function(t){window.console&&s.debug&&window.console.log(t)},alert:function(t){window.alert&&window.alert(t)},checkContainer:function(t){return s.log("Curator->checkContainer: "+t),0!==e(t).length||(window.console&&window.console.log("Curator could not find the element "+t+". Please ensure this element existings in your HTML code. Exiting."),!1)},checkPowered:function(t){return s.log("Curator->checkPowered"),t.html().indexOf("Curator")>0||(s.alert("Container is missing Powered by Curator"),!1)},addCSSRule:function(t,e,i,s){"insertRule"in t?t.insertRule(e+"{"+i+"}",0):"addRule"in t&&t.addRule(e,i)},createSheet:function(){var t=document.createElement("style");return t.appendChild(document.createTextNode("")),document.head.appendChild(t),t.sheet},loadWidget:function(t){var e=window.Curator[t.type],i=new e(t);return window.curatorWidget=i,i},loadCSS:function(){},Templates:{},Config:{Defaults:{apiEndpoint:"https://api.curator.io/v1.1",feedId:"",postsPerPage:12,maxPosts:0,templatePost:"v2-post",templatePopup:"v1-popup",templatePopupWrapper:"v1-popup-wrapper",templateFilter:"v1-filter",showPopupOnClick:!0,onPostsLoaded:function(){},filter:{showNetworks:!1,networksLabel:"Networks:",showSources:!1,sourcesLabel:"Sources:"}}}};void 0===e&&s.alert("Curator requires jQuery. \n\nPlease include jQuery in your HTML before the Curator widget script tag.\n\nVisit http://jquery.com/download/ to get the latest version"),s.serialize=function(t){return"?"+Object.keys(t).reduce(function(e,i){return e.push(i+"="+encodeURIComponent(t[i])),e},[]).join("&")},s.ajax=function(e,i,o,r){var n=t.location.protocol,a=e.indexOf("://");a&&(e=e.substr(a+3)),n="https:"!=n&&"http:"!=n?"https:":n,e=n+"//"+e,i&&(e+=s.serialize(i)),nanoajax({url:e,cors:!0},function(t,e){t?o(JSON.parse(e)):r(t,e)})};var o=function(){this.listeners={}};o.prototype.on=function(t,e,i){for(var s=arguments,o=[],r=arguments.length,n=0;n<r;n++)o.push(s[n]);o=o.length>3?o.splice(3,o.length-1):[],void 0!==this.listeners[t]?this.listeners[t].push({scope:i,callback:e,args:o}):this.listeners[t]=[{scope:i,callback:e,args:o}]},o.prototype.off=function(t,e,i){var s=this;if(void 0!==this.listeners[t]){for(var o=this.listeners[t].length,r=[],n=0;n<o;n++){var a=s.listeners[t][n];a.scope===i&&a.callback===e||r.push(a)}this.listeners[t]=r}},o.prototype.has=function(t,e,i){var s=this;if(void 0!==this.listeners[t]){var o=this.listeners[t].length;if(void 0===e&&void 0===i)return o>0;for(var r=0;r<o;r++){var n=s.listeners[t][r];if((!i||n.scope===i)&&n.callback===e)return!0}}return!1},o.prototype.trigger=function(t){for(var e=arguments,i=this,s=0,o={type:t},r=[],n=1;n<arguments.length;n++)r.push(e[n]);if(r=[o].concat(r),void 0!==this.listeners[t])for(var a=this.listeners[t].length,u=0;u<a;u++){var l=i.listeners[t][u];if(l&&l.callback){var c=r.concat(l.args);l.callback.apply(l.scope,c),s+=1}}},o.prototype.getEvents=function(){var t=this,e="";for(var i in this.listeners)for(var s=t.listeners[i].length,o=0;o<s;o++){var r=t.listeners[i][o];e+=r.scope&&r.scope.className?r.scope.className:"anonymous",e+=" listen for '"+i+"'\n"}return e},o.prototype.destroy=function(){this.listeners={}},s.EventBus=new o,s.Events={FEED_LOADED:"feed:loaded",FEED_FAILED:"feed:failed",FILTER_CHANGED:"filter:changed",POSTS_LOADED:"posts:loaded",POSTS_FAILED:"posts:failed",POST_CREATED:"post:created",POST_CLICK:"post:click",POST_CLICK_READ_MORE:"post:clickReadMore",POST_IMAGE_LOADED:"post:imageLoaded",CAROUSEL_CHANGED:"curator:changed"};var r=function(t){function i(e){t.call(this),s.log("Feed->init with options"),this.widget=e,this.posts=[],this.currentPage=0,this.postsLoaded=0,this.postCount=0,this.loading=!1,this.allPostsLoaded=!1,this.pagination={after:null,before:null},this.options=this.widget.options,this.params=this.options.feedParams||{},this.params.limit=this.options.postsPerPage,this.feedBase=this.options.apiEndpoint+"/feeds"}return t&&(i.__proto__=t),i.prototype=Object.create(t&&t.prototype),i.prototype.constructor=i,i.prototype.loadPosts=function(t,i){if(t=t||0,s.log("Feed->loadPosts "+this.loading),this.loading)return!1;this.currentPage=t;var o=e.extend({},this.options.feedParams,i);o.limit=this.options.postsPerPage,o.offset=t*this.options.postsPerPage,this._loadPosts(o)},i.prototype.loadMore=function(t){if(s.log("Feed->loadMore "+this.loading),this.loading)return!1;var i={limit:this.options.postsPerPage};e.extend(i,this.options.feedParams,t),i.offset=this.posts.length,this._loadPosts(i)},i.prototype.load=function(t){if(s.log("Feed->load "+this.loading),this.loading)return!1;this.currentPage=0;var i=e.extend(this.params,t);this._loadPosts(i)},i.prototype.loadAfter=function(){if(s.log("Feed->loadAfter "+this.loading),this.loading)return!1;this.currentPage=0;var t=e.extend({},this.params);this.pagination&&this.pagination.after&&(t.after=this.pagination.after,delete t.before),this._loadPosts(t)},i.prototype._loadPosts=function(t){var e=this;s.log("Feed->_loadPosts"),this.loading=!0,s.ajax(this.getUrl("/posts"),t,function(t){s.log("Feed->_loadPosts success"),t.success?(e.postCount=t.postCount,e.postsLoaded+=t.posts.length,e.allPostsLoaded=e.postsLoaded>=e.postCount,e.posts=e.posts.concat(t.posts),e.networks=t.networks,t.pagination&&(e.pagination=t.pagination),e.widget.trigger(s.Events.FEED_LOADED,t),e.widget.trigger(s.Events.POSTS_LOADED,t.posts),e.trigger(s.Events.FEED_LOADED,t),e.trigger(s.Events.POSTS_LOADED,t.posts)):e.trigger(s.Events.POSTS_FAILED,t.posts),e.loading=!1},function(t,i,o){s.log("Feed->_loadPosts fail"),s.log(i),s.log(o),e.trigger(s.Events.POSTS_FAILED,[]),e.loading=!1})},i.prototype.loadPost=function(t,i,s){s=s||function(){},e.get(this.getUrl("/post/"+t),{},function(t){t.success?i(t.post):s()})},i.prototype.inappropriatePost=function(t,i,s,o){var r={reason:i};e.post(this.getUrl("/post/"+t+"/inappropriate"),r,function(t,i,r){t=e.parseJSON(t),t.success===!0?s():o(r)})},i.prototype.lovePost=function(t,i,s){var o={};e.post(this.getUrl("/post/"+t+"/love"),o,function(t,o,r){t=e.parseJSON(t),t.success===!0?i(t.loves):s(r)})},i.prototype.getUrl=function(t){return this.feedBase+"/"+this.options.feedId+t},i.prototype.destroy=function(){t.prototype.destroy.call(this)},i}(o);s.Feed=r;var n=function(t){var i=this;s.log("Filter->construct"),this.client=t,this.options=t.options,this.$filter=s.Template.render(this.options.templateFilter,{}),this.$filterNetworks=this.$filter.find(".crt-filter-networks"),this.$filterNetworksUl=this.$filter.find(".crt-filter-networks ul"),this.$filterSources=this.$filter.find(".crt-filter-sources"),this.$filterSourcesUl=this.$filter.find(".crt-filter-sources ul"),this.client.$container.append(this.$filter),this.$filterNetworks.find("label").text(this.client.options.filter.networksLabel),this.$filterSources.find("label").text(this.client.options.filter.sourcesLabel),this.$filter.on("click",".crt-filter-networks a",function(t){t.preventDefault();var o=e(t.target),r=o.data("network");i.$filter.find(".crt-filter-networks li").removeClass("active"),o.parent().addClass("active"),i.client.trigger(s.Events.FILTER_CHANGED),r?i.client.feed.loadPosts(0,{network_id:r}):i.client.feed.loadPosts(0,{})}),this.$filter.on("click",".crt-filter-sources a",function(t){t.preventDefault();var o=e(t.target),r=o.data("source");i.$filter.find(".crt-filter-sources li").removeClass("active"),o.parent().addClass("active"),i.client.trigger(s.Events.FILTER_CHANGED),r?i.client.feed.loadPosts(0,{source_id:r}):i.client.feed.loadPosts(0,{})}),this.client.on(s.Events.FEED_LOADED,this.onPostsLoaded.bind(this))};n.prototype.onPostsLoaded=function(t,e){var i=this,o=e.networks;if(!this.filtersLoaded){if(this.options.filter.showNetworks){this.$filterNetworksUl.append('<li class="crt-filter-label"><label>'+this.client.options.filter.networksLabel+"</label></li>"),this.$filterNetworksUl.append('<li class="active"><a href="#" data-network="0"> All</a></li>');for(var r=0,n=o;r<n.length;r+=1){var a=n[r],u=s.Networks[a];u?i.$filterNetworksUl.append('<li><a href="#" data-network="'+a+'"><i class="'+u.icon+'"></i> '+u.name+"</a></li>"):console.log(a)}}else this.$filterNetworks.hide();if(this.options.filter.showSources){this.$filterSourcesUl.append('<li class="crt-filter-label"><label>'+this.client.options.filter.sourcesLabel+"</label></li>"),this.$filterSourcesUl.append('<li class="active"><a href="#" data-source="0"> All</a></li>');for(var l=0,c=e.sources;l<c.length;l+=1){var p=c[l],h=s.Networks[p.network_id];h?i.$filterSourcesUl.append('<li><a href="#" data-source="'+p.id+'"><i class="'+h.icon+'"></i> '+p.name+"</a></li>"):console.log(p.network_id)}}else this.$filterSources.hide();this.filtersLoaded=!0}},n.prototype.destroy=function(){this.$filter.remove()},s.Filter=n,s.Networks={1:{name:"Twitter",icon:"crt-icon-twitter"},2:{name:"Instagram",icon:"crt-icon-instagram"},3:{name:"Facebook",icon:"crt-icon-facebook"},4:{name:"Pinterest",icon:"crt-icon-pinterest"},5:{name:"Google",icon:"crt-icon-google"},6:{name:"Vine",icon:"crt-icon-vine"},7:{name:"Flickr",icon:"crt-icon-flickr"},8:{name:"Youtube",icon:"crt-icon-youtube"},9:{name:"Tumblr",icon:"crt-icon-tumblr"},10:{name:"RSS",icon:"crt-icon-rss"},11:{name:"LinkedIn",icon:"crt-icon-linkedin"}},function(){var t={},e={networkIcon:function(){return this.data.network_name.toLowerCase()},networkName:function(){return this.data.network_name.toLowerCase()},userUrl:function(){if(this.data.user_url&&""!==this.data.user_url)return this.data.user_url;if(this.data.originator_user_url&&""!==this.data.originator_user_url)return this.data.originator_user_url;if(this.data.userUrl&&""!==this.data.userUrl)return this.data.userUrl;var t=this.data.network_id+"";return"1"===t?"http://twitter.com/"+this.data.user_screen_name:"2"===t?"http://instagram.com/"+this.data.user_screen_name:"3"===t?"http://facebook.com/"+this.data.user_screen_name:"#"},parseText:function(t){return this.data.is_html?t:("Twitter"===this.data.network_name?(t=s.StringUtils.linksToHref(t),t=s.StringUtils.twitterLinks(t)):"Instagram"===this.data.network_name?(t=s.StringUtils.linksToHref(t),t=s.StringUtils.instagramLinks(t)):"Facebook"===this.data.network_name?(t=s.StringUtils.linksToHref(t),t=s.StringUtils.facebookLinks(t)):t=s.StringUtils.linksToHref(t),s.StringUtils.nl2br(t))},nl2br:function(t){return s.StringUtils.nl2br(t)},contentImageClasses:function(){return this.data.image?"crt-post-has-image":"crt-post-content-image-hidden crt-post-no-image"},contentTextClasses:function(){return this.data.text?"crt-post-has-text":"crt-post-content-text-hidden crt-post-no-text"},fuzzyDate:function(t){var e=Date.parse(t+" UTC"),i=Math.round((new Date-e)/1e3);return i<30?"Just now":i<60?i+" seconds ago":i<120?"a minute ago.":i<3600?Math.floor(i/60)+" minutes ago":1===Math.floor(i/3600)?"1 hour ago.":i<86400?Math.floor(i/3600)+" hours ago":i<172800?"Yesterday":i<604800?"This week":i<1209600?"Last week":i<2592e3?"This month":e},prettyDate:function(t){var e=s.DateUtils.dateFromString(t),i=((new Date).getTime()-e.getTime())/1e3,o=Math.floor(i/86400),r=e.getFullYear(),n=e.getMonth()+1,a=e.getDate();return isNaN(o)||o<0||o>=31?r.toString()+"-"+(n<10?"0"+n.toString():n.toString())+"-"+(a<10?"0"+a.toString():a.toString()):0===o&&(i<60&&"just now"||i<120&&"1 minute ago"||i<3600&&Math.floor(i/60)+" minutes ago"||i<7200&&"1 hour ago"||i<86400&&Math.floor(i/3600)+" hours ago")||1===o&&"Yesterday"||o<7&&o+" days ago"||o<31&&Math.ceil(o/7)+" weeks ago"}};s.render=function(i,s){var o="";try{var r=t[i];if(!r){var n=i.replace(/[\r\t\n]/g," ").replace(/'(?=[^%]*%>)/g,"\t").split("'").join("\\'").split("\t").join("'").replace(/<%=(.+?)%>/g,"',$1,'").split("<%").join("');").split("%>").join("p.push('"),a="var p=[],print=function(){p.push.apply(p,arguments);};with(obj){p.push('"+n+"');}return p.join('');";r=new Function("obj",a),t[i]=r}return e.data=s,r.call(e,s)}catch(t){window.console.log("Template parse error: "+t.message),o=t.message}return" # ERROR: "+o+" # "}}(),s.SocialFacebook={share:function(t){var e=t;e.url=s.Utils.postUrl(t),e.cleanText=s.StringUtils.filterHtml(t.text);0!==e.url.indexOf("http")&&(e.url=e.image);var i=s.Utils.tinyparser("https://www.facebook.com/sharer/sharer.php?u={{url}}&d={{cleanText}}",e);s.Utils.popup(i,"twitter","600","430","0")}},s.SocialPinterest={share:function(t){var e=t;e.url=s.Utils.postUrl(t);s.Utils.popup(s.Utils.tinyparser("http://pinterest.com/pin/create/button/?url={{url}}&media={{image}}&description={{text}}",e),"pintrest","600","270","0")}},s.SocialTwitter={share:function(t){var e=t;e.url=s.Utils.postUrl(t),e.cleanText=s.StringUtils.filterHtml(t.text);var i="http://twitter.com/share?url={{url}}&text={{cleanText}}&hashtags={{hashtags}}";console.log(i);var o=s.Utils.tinyparser(i,e);s.Utils.popup(o,"twitter","600","430","0")}};var a='<div class="crt-filter"> <div class="crt-filter-networks"><ul class="crt-networks"> </ul></div> <div class="crt-filter-sources"><ul class="crt-sources"> </ul></div> </div>',u=' <div class="crt-popup-wrapper">     <div class="crt-popup-wrapper-c">         <div class="crt-popup-underlay"></div>         <div class="crt-popup-container"></div>     </div> </div>',l=' <div class="crt-popup">     <a href="#" class="crt-close crt-icon-cancel"></a>     <a href="#" class="crt-next crt-icon-right-open"></a>     <a href="#" class="crt-previous crt-icon-left-open"></a>     <div class="crt-popup-left">          <div class="crt-video">             <div class="crt-video-container">                <video preload="none">                <source src="<%=video%>" type="video/mp4" >                </video>                <img src="<%=image%>" />                <a href="javascript:;" class="crt-play"><i class="crt-play-icon"></i></a>             </div>         </div>         <div class="crt-image">             <img src="<%=image%>" />         </div>     </div>     <div class="crt-popup-right">         <div class="crt-popup-header">             <span class="crt-social-icon"><i class="crt-icon-<%=this.networkIcon()%>"></i></span>             <img src="<%=user_image%>"  />             <div class="crt-post-name"><span><%=user_full_name%></span><br/><a href="<%=this.userUrl()%>" target="_blank">@<%=user_screen_name%></a></div>         </div>         <div class="crt-popup-text <%=this.contentTextClasses()%>">             <div class="crt-popup-text-container">                 <p class="crt-date"><%=this.prettyDate(source_created_at)%></p>                 <div class="crt-popup-text-body"><%=this.parseText(text)%></div>             </div>         </div>         <div class="crt-popup-footer">            <div class="crt-post-share"><span class="ctr-share-hint"></span><a href="#" class="crt-share-facebook"><i class="crt-icon-facebook"></i></a>  <a href="#" class="crt-share-twitter"><i class="crt-icon-twitter"></i></a></div>        </div>     </div> </div>';s.Templates={"v1-post":' <div class="crt-post-v1 crt-post-c">    <div class="crt-post-bg"></div>     <div class="crt-post post<%=id%> crt-post-<%=this.networkIcon()%>">         <div class="crt-post-header">             <span class="crt-social-icon"><i class="crt-icon-<%=this.networkIcon()%>"></i></span>             <img src="<%=user_image%>"  />             <div class="crt-post-name">            <div class="crt-post-fullname"><%=user_full_name%></div>            <div class="crt-post-username"><a href="<%=this.userUrl()%>" target="_blank">@<%=user_screen_name%></a></div>            </div>         </div>         <div class="crt-post-content">             <div class="crt-image crt-hitarea crt-post-content-image <%=this.contentImageClasses()%>" >                 <div class="crt-image-c"><img src="<%=image%>" class="crt-post-image" /></div>                 <span class="crt-play"><i class="crt-play-icon"></i></span>             </div>             <div class="text crt-post-content-text <%=this.contentTextClasses()%>">                 <div class="crt-post-text-body"><%=this.parseText(text)%></div>             </div>         </div>         <div class="crt-post-footer">            <div class="crt-date"><%=this.prettyDate(source_created_at)%></div>             <div class="crt-post-share"><span class="ctr-share-hint"></span><a href="#" class="crt-share-facebook"><i class="crt-icon-facebook"></i></a>  <a href="#" class="crt-share-twitter"><i class="crt-icon-twitter"></i></a></div>        </div>         <div class="crt-post-read-more"><a href="#" class="crt-post-read-more-button">Read more</a> </div>     </div></div>',"v1-filter":a,"v1-popup":l,"v1-popup-underlay":"","v1-popup-wrapper":u,"v1-grid-post":' <div class="crt-post-c">    <div class="crt-post post<%=id%> <%=this.contentImageClasses()%> <%=this.contentTextClasses()%>">         <div class="crt-post-content">             <div class="crt-hitarea" >                 <img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" class="spacer" />                 <div class="crt-post-content-image" style="background-image: url(<%=image%>);"> </div>                 <div class="crt-post-content-text-c">                     <div class="crt-post-content-text">                         <%=this.parseText(text)%>                     </div>                 </div>                 <a href="javascript:;" class="crt-play"><i class="crt-play-icon"></i></a>                 <span class="crt-social-icon crt-social-icon-normal"><i class="crt-icon-<%=this.networkIcon()%>"></i></span>                 <div class="crt-post-hover">                    <div class="crt-post-header">                         <img src="<%=user_image%>"  />                         <div class="crt-post-name"><span><%=user_full_name%></span><br/><a href="<%=this.userUrl()%>" target="_blank">@<%=user_screen_name%></a></div>                     </div>                     <div class="crt-post-hover-text">                         <%=this.parseText(text)%>                     </div>                     <span class="crt-social-icon crt-social-icon-hover"><i class="crt-icon-<%=this.networkIcon()%>"></i></span>                 </div>             </div>         </div>     </div></div>',"v2-post":' <div class="crt-post-v2 crt-post crt-post-<%=this.networkIcon()%> <%=this.contentTextClasses()%>  <%=this.contentImageClasses()%>" data-post="<%=id%>">     <div class="crt-post-border">        <div class="crt-post-c">            <div class="crt-post-content">                <div class="crt-image crt-hitarea crt-post-content-image" >                     <div class="crt-image-c"><img src="<%=image%>" class="crt-post-image" /></div>                     <span class="crt-play"><i class="crt-play-icon"></i></span>                 </div>                 <div class="crt-post-header">                     <span class="crt-social-icon"><i class="crt-icon-<%=this.networkIcon()%>"></i></span>                     <div class="crt-post-fullname"><a href="<%=this.userUrl()%>" target="_blank"><%=user_full_name%></a></div>                </div>                 <div class="text crt-post-content-text">                     <%=this.parseText(text)%>                 </div>                 <div class="crt-post-read-more"><a href="#" class="crt-post-read-more-button">Read more</a> </div>             </div>             <div class="crt-post-footer">                <img class="crt-post-userimage" src="<%=user_image%>" />                 <span class="crt-post-username"><a href="<%=this.userUrl()%>" target="_blank">@<%=user_screen_name%></a></span>                <span class="crt-date"><%=this.prettyDate(source_created_at)%></span>                 <div class="crt-post-share"><span class="ctr-share-hint"></span><a href="#" class="crt-share-facebook"><i class="crt-icon-facebook"></i></a>  <a href="#" class="crt-share-twitter"><i class="crt-icon-twitter"></i></a></div>            </div>         </div>     </div> </div>',"v2-filter":a,"v2-popup":l,"v2-popup-underlay":"","v2-popup-wrapper":u,
"v2-grid-post":' <div class="crt-grid-post crt-grid-post-v2 crt-post-<%=id%> <%=this.contentImageClasses()%> <%=this.contentTextClasses()%>">     <div class="crt-post-c">         <div class="crt-post-content">             <div class="crt-hitarea" >                 <img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" class="crt-spacer" />                 <div class="crt-grid-post-image">                    <div class="crt-post-content-image" style="background-image: url(<%=image%>);"> </div>                     <a href="javascript:;" class="crt-play"><i class="crt-play-icon"></i></a>                     <span class="crt-social-icon crt-social-icon-normal"><i class="crt-icon-<%=this.networkIcon()%>"></i></span>                 </div>                <div class="crt-grid-post-text">                    <div class="crt-grid-post-text-wrap">                         <div><%=this.parseText(text)%></div>                     </div>                     <span class="crt-social-icon crt-social-icon-normal"><i class="crt-icon-<%=this.networkIcon()%>"></i></span>                 </div>                <div class="crt-post-hover">                    <div class="crt-post-header">                         <span class="crt-social-icon"><i class="crt-icon-<%=this.networkIcon()%>"></i></span>                         <div class="crt-post-fullname"><a href="<%=this.userUrl()%>" target="_blank"><%=user_full_name%></a></div>                    </div>                     <div class="crt-post-content-text">                         <%=this.parseText(text)%>                     </div>                     <div class="crt-post-read-more"><a href="#" class="crt-post-read-more-button">Read more</a> </div>                     <div class="crt-post-footer">                        <img class="crt-post-userimage" src="<%=user_image%>" />                         <span class="crt-post-username"><a href="<%=this.userUrl()%>" target="_blank">@<%=user_screen_name%></a></span>                        <span class="crt-date"><%=this.prettyDate(source_created_at)%></span>                         <div class="crt-post-share"><span class="ctr-share-hint"></span><a href="#" class="crt-share-facebook"><i class="crt-icon-facebook"></i></a>  <a href="#" class="crt-share-twitter"><i class="crt-icon-twitter"></i></a></div>                    </div>                 </div>             </div>         </div>     </div></div>',"v2-grid-feed":' <div class="crt-feed-window">    <div class="crt-feed"></div></div><div class="crt-feed-more"><a href="#">Load more</a></div>'},s.Template={render:function(t,i){var o="";if(1===e("#"+t).length?o=e("#"+t).html():void 0!==s.Templates[t]&&(o=s.Templates[t]),""===o)throw new Error("Could not find template "+t);var r=s.render(o,i);return e.parseHTML&&(r=e.parseHTML(r)),e(r).filter("div")}},s.UI={Layout:{}},s.UI.Layout.CarouselSettings={circular:!1,speed:5e3,duration:700,minWidth:250,panesVisible:null,moveAmount:0,autoPlay:!1,useCss:!0},e.zepto&&(s.UI.Layout.CarouselSettings.easing="ease-in-out");var c=function(t){function i(i,o){s.log("LayoutCarousel->construct"),t.call(this),this.id=s.Utils.uId(),this.current_position=0,this.animating=!1,this.timeout=null,this.FAKE_NUM=0,this.PANES_VISIBLE=0,this.options=e.extend({},s.UI.Layout.CarouselSettings,o),this.$viewport=e(i),this.$panes=this.$viewport.children(),this.$panes.detach(),this.$stage=e('<div class="ctr-carousel-stage"></div>').appendTo(this.$viewport),this.$pane_slider=e('<div class="ctr-carousel-slider"></div>').appendTo(this.$stage),this.addControls(),this.createHandlers(),this.update()}return t&&(i.__proto__=t),i.prototype=Object.create(t&&t.prototype),i.prototype.constructor=i,i.prototype.createHandlers=function(){var t=this;e(window).on("resize."+this.id,s.Utils.debounce(function(){t.updateLayout()},100))},i.prototype.destroyHandlers=function(){e(window).off("resize."+this.id)},i.prototype.update=function(){s.log("LayoutCarousel->update "),this.$panes=this.$pane_slider.children(),this.NUM_PANES=this.options.circular?this.$panes.length+1:this.$panes.length,this.NUM_PANES>0&&(this.resize(),this.move(this.current_position,!0),this.animating||this.options.autoPlay&&this.animate())},i.prototype.add=function(t){s.log("LayoutCarousel->add "+t.length),this.$pane_slider.append(t),this.$panes=this.$pane_slider.children()},i.prototype.resize=function(){var t=this,i=this.options.infinite?100*(this.NUM_PANES+1)+"%":100*this.NUM_PANES+"%";if(this.$pane_slider.css({width:i}),this.VIEWPORT_WIDTH=this.$viewport.width(),this.options.panesVisible?(this.PANES_VISIBLE=this.options.panesVisible(),this.PANE_WIDTH=this.VIEWPORT_WIDTH/this.PANES_VISIBLE):(this.PANES_VISIBLE=this.VIEWPORT_WIDTH<this.options.minWidth?1:Math.floor(this.VIEWPORT_WIDTH/this.options.minWidth),this.PANE_WIDTH=this.VIEWPORT_WIDTH/this.PANES_VISIBLE),this.options.infinite){this.$panes.filter(".crt-clone").remove();for(var s=this.NUM_PANES-1;s>this.NUM_PANES-1-this.PANES_VISIBLE;s--){var o=t.$panes.eq(s).clone();o.addClass("crt-clone"),o.css("opacity","1"),o.find(".crt-post-image").css({opacity:1}),t.$pane_slider.prepend(o),t.FAKE_NUM=t.PANES_VISIBLE}this.$panes=this.$pane_slider.children()}this.$panes.each(function(i,s){e(s).css({width:t.PANE_WIDTH+"px"})})},i.prototype.updateLayout=function(){this.resize(),this.move(this.current_position,!0),this.options.autoPlay&&this.animate()},i.prototype.animate=function(){var t=this;this.animating=!0,clearTimeout(this.timeout),this.timeout=setTimeout(function(){t.next()},this.options.speed)},i.prototype.next=function(){var t=this.options.moveAmount?this.options.moveAmount:this.PANES_VISIBLE;this.move(this.current_position+t,!1)},i.prototype.prev=function(){var t=this.options.moveAmount?this.options.moveAmount:this.PANES_VISIBLE;this.move(this.current_position-t,!1)},i.prototype.move=function(t,e){s.log("LayoutCarousel->move "+t),this.current_position=t;var i=this.NUM_PANES-this.PANES_VISIBLE;this.current_position<0?this.current_position=0:this.current_position>i&&(this.current_position=i);var o=this.FAKE_NUM+this.current_position,r=o*this.PANE_WIDTH,n=this.options.infinite?this.PANE_WIDTH*this.NUM_PANES:this.PANE_WIDTH*this.NUM_PANES-this.VIEWPORT_WIDTH;this.currentLeft=r,this.currentLeft=r<0?0:r>n?n:r;var a=0-this.currentLeft;if(s.log("LayoutCarousel->move x:"+a),e)this.$pane_slider.css({transform:"translate3d("+a+"px, 0px, 0px)"}),this.moveComplete();else{var u={duration:this.options.duration,complete:this.moveComplete.bind(this)};this.options.easing&&(u.easing=this.options.easing),this.$pane_slider.addClass("crt-animate-transform"),this.$pane_slider.animate({transform:"translate3d("+a+"px, 0px, 0px)"},u)}},i.prototype.moveComplete=function(){var t=this;s.log("LayoutCarousel->moveComplete"),this.options.infinite&&this.current_position>=this.NUM_PANES-this.PANES_VISIBLE&&(this.$pane_slider.css({transform:"translate3d(0px, 0px, 0px)"}),this.current_position=0-this.PANES_VISIBLE,this.currentLeft=0),setTimeout(function(){t.updateHeight()},50),this.trigger(s.Events.CAROUSEL_CHANGED,[this,this.current_position]),this.options.autoPlay&&this.animate()},i.prototype.updateHeight=function(){var t=this;s.log("LayoutCarousel->updateHeight");for(var i=0,o=this.options.infinite?this.current_position+this.FAKE_NUM:this.current_position,r=o+this.PANES_VISIBLE,n=o;n<r;n++){var a=e(t.$panes[n]).height();a>i&&(i=a)}this.$stage.height()!==i&&this.$stage.animate({height:i},300)},i.prototype.addControls=function(){this.$viewport.append('<button type="button" data-role="none" class="crt-panel-prev crt-panel-arrow" aria-label="Previous" role="button" aria-disabled="false">Previous</button>'),this.$viewport.append('<button type="button" data-role="none" class="crt-panel-next crt-panel-arrow" aria-label="Next" role="button" aria-disabled="false">Next</button>'),this.$viewport.on("click",".crt-panel-prev",this.prev.bind(this)),this.$viewport.on("click",".crt-panel-next",this.next.bind(this))},i.prototype.destroy=function(){this.destroyHandlers(),clearTimeout(this.timeout)},i}(o);s.UI.Layout.Carousel=c,s.UI.Layout.WaterfallSettings={selector:".item",width:225,gutter:20,animate:!1,animationOptions:{speed:200,duration:300,effect:"fadeInOnAppear",queue:!0,complete:function(){}}};var p=function(t,i){s.log("WaterfallLayout->onPostsLoaded"),this.element=e(i),this.id=s.Utils.uId();this.name=this._setName(5),this.gridArr=[],this.gridArrAppend=[],this.gridArrPrepend=[],this.setArr=!1,this.setGrid=!1,this.cols=0,this.itemCount=0,this.isPrepending=!1,this.appendCount=0,this.resetCount=!0,this.ifCallback=!0,this.box=this.element,this.boxWidth=this.box.width(),this.options=e.extend(!0,{},s.UI.Layout.WaterfallSettings,t),this.gridArr=e.makeArray(this.box.find(this.options.selector)),this.isResizing=!1,this.w=0,this.boxArr=[],this._setCols(),this._renderGrid("append"),e(this.box).addClass("gridalicious"),this.createHandlers()};p.prototype.createHandlers=function(){var t=this;s.log("WaterfallLayout->createHandlers"),e(window).on("resize."+this.id,s.Utils.debounce(function(){t.resize()},100))},p.prototype.destroyHandlers=function(){s.log("WaterfallLayout->destroyHandlers"),e(window).off("resize."+this.id)},p.prototype._setName=function(t,e){return e=e?e:"",t?this._setName(--t,"0123456789ABCDEFGHIJKLMNOPQRSTUVWXTZabcdefghiklmnopqrstuvwxyz".charAt(Math.floor(60*Math.random()))+e):e},p.prototype._setCols=function(){var t=this;this.cols=Math.floor(this.box.width()/this.options.width),this.cols<1&&(this.cols=1),diff=(this.box.width()-this.cols*this.options.width-this.options.gutter)/this.cols,w=(this.options.width+diff)/this.box.width()*100,this.w=w,this.colHeights=new Array(this.cols),this.colHeights.fill(0),this.colItems=new Array(this.cols),this.colItems.fill([]);for(var i=0;i<this.cols;i++){var s=e("<div></div>").addClass("galcolumn").attr("id","item"+i+t.name).css({width:w+"%",paddingLeft:t.options.gutter,paddingBottom:t.options.gutter,float:"left","-webkit-box-sizing":"border-box","-moz-box-sizing":"border-box","-o-box-sizing":"border-box","box-sizing":"border-box"});t.box.append(s)}},p.prototype._renderGrid=function(t,i,s,o){var r=this,n=[],a=[],u=this.appendCount,l=(this.options.gutter,this.cols),c=this.name;e(".galcolumn").width();i?(a=i,"append"===t&&(u+=s,this.appendCount),"prepend"===t&&(this.isPrepending=!0,Math.round(s%l)<=0&&l),"renderAfterPrepend"===t&&(u+=s)):(a=this.gridArr,u=e(this.gridArr).length);for(var p=0,h=a;p<h.length;p+=1){var d=h[p];d.hasClass("not-responsive")&&"auto",d.css({zoom:"1",filter:"alpha(opacity=0)",opacity:"0"});for(var f=0,g=1;g<this.colHeights.length;g++)r.colHeights[g]<r.colHeights[f]&&(f=g);"prepend"===t?(e("#item"+f+c).prepend(d),n.push(d)):(e("#item"+f+c).append(d),n.push(d),u>=l&&(u-=l)),r.colItems[f].push(d),r.colHeights[f]+=d.height()}this.appendCount=u,"append"===t||"prepend"===t?("prepend"===t&&this._updateAfterPrepend(this.gridArr,a),this._renderItem(n),this.isPrepending=!1):this._renderItem(this.gridArr)},p.prototype._collectItems=function(){var t=[];return e(this.box).find(this.options.selector).each(function(i){t.push(e(this))}),t},p.prototype._renderItem=function(t){var i=this.options.animationOptions.speed,s=this.options.animationOptions.effect,o=this.options.animationOptions.duration,r=this.options.animationOptions.queue,n=this.options.animate,a=this.options.animationOptions.complete,u=0,l=0;n!==!0||this.isResizing?(e.each(t,function(t,i){e(i).css({opacity:"1",filter:"alpha(opacity=100)"})}),this.ifCallback&&a.call(t)):(r===!0&&"fadeInOnAppear"===s?(this.isPrepending&&t.reverse(),e.each(t,function(s,r){setTimeout(function(){e(r).animate({opacity:"1.0"},o),++l===t.length&&a.call(void 0,t)},u*i),u++})):r===!1&&"fadeInOnAppear"===s&&(this.isPrepending&&t.reverse(),e.each(t,function(i,s){e(s).animate({opacity:"1.0"},o),++l===t.length&&this.ifCallback&&a.call(void 0,t)})),r!==!0||s||e.each(t,function(i,s){e(s).css({opacity:"1",filter:"alpha(opacity=100)"}),++l===t.length&&this.ifCallback&&a.call(void 0,t)}))},p.prototype._updateAfterPrepend=function(t,i){var s=this.gridArr;e.each(i,function(t,e){s.unshift(e)}),this.gridArr=s},p.prototype.resize=function(){if(this.box.width()!==this.boxWidth){var t=Math.floor(this.box.width()/this.options.width);this.cols!==t&&(this.box.find(e(".galcolumn")).remove(),this._setCols(),this.ifCallback=!1,this.isResizing=!0,this._renderGrid("append"),this.ifCallback=!0,this.isResizing=!1,this.boxWidth=this.box.width())}},p.prototype.append=function(t){var i=this.gridArr,s=this.gridArrPrepend;e.each(t,function(t,e){i.push(e),s.push(e)}),this._renderGrid("append",t,e(t).length)},p.prototype.prepend=function(t){this.ifCallback=!1,this._renderGrid("prepend",t,e(t).length),this.ifCallback=!0},p.prototype.destroy=function(){this.destroyHandlers()},s.UI.Layout.Waterfall=p;var h=function(t,e,i){s.log("Popup->init "),this.popupManager=t,this.json=e.json,this.widget=i;var o=this.widget.options.templatePopup;if(this.videoPlaying=!1,this.$popup=s.Template.render(o,this.json),this.json.image&&this.$popup.addClass("has-image"),this.json.video&&this.$popup.addClass("has-video"),this.json.video&&this.json.video.indexOf("youtu")>=0){this.$popup.find("video").remove();var r=s.StringUtils.youtubeVideoId(this.json.video),n='<iframe id="ytplayer" type="text/html" width="615" height="615"         src="https://www.youtube.com/embed/'+r+'?autoplay=0&rel=0&showinfo"         frameborder="0"></iframe>';this.$popup.find(".crt-video-container img").remove(),this.$popup.find(".crt-video-container a").remove(),this.$popup.find(".crt-video-container").append(n)}else if(this.json.video&&this.json.video.indexOf("vimeo")>=0){this.$popup.find("video").remove();var a=s.StringUtils.vimeoVideoId(this.json.video);if(a){var u='<iframe src="https://player.vimeo.com/video/'+a+'?color=ffffff&title=0&byline=0&portrait=0" width="615" height="615" frameborder="0" webkitallowfullscreen mozallowfullscreen allowfullscreen></iframe>';this.$popup.find(".crt-video-container img").remove(),this.$popup.find(".crt-video-container a").remove(),this.$popup.find(".crt-video-container").append(u)}}this.$popup.on("click"," .crt-close",this.onClose.bind(this)),this.$popup.on("click"," .crt-previous",this.onPrevious.bind(this)),this.$popup.on("click"," .crt-next",this.onNext.bind(this)),this.$popup.on("click"," .crt-play",this.onPlay.bind(this)),this.$popup.on("click",".crt-share-facebook",this.onShareFacebookClick.bind(this)),this.$popup.on("click",".crt-share-twitter",this.onShareTwitterClick.bind(this))};h.prototype.onShareFacebookClick=function(t){return t.preventDefault(),s.SocialFacebook.share(this.json),this.widget.track("share:facebook"),!1},h.prototype.onShareTwitterClick=function(t){return t.preventDefault(),s.SocialTwitter.share(this.json),this.widget.track("share:twitter"),!1},h.prototype.onClose=function(t){t.preventDefault();var e=this;this.hide(function(){e.popupManager.onClose()})},h.prototype.onPrevious=function(t){t.preventDefault(),this.popupManager.onPrevious()},h.prototype.onNext=function(t){t.preventDefault(),this.popupManager.onNext()},h.prototype.onPlay=function(t){s.log("Popup->onPlay"),t.preventDefault(),this.videoPlaying=!this.videoPlaying,this.videoPlaying?(this.$popup.find("video")[0].play(),this.widget.track("video:play")):(this.$popup.find("video")[0].pause(),this.widget.track("video:pause")),s.log(this.videoPlaying),this.$popup.toggleClass("video-playing",this.videoPlaying)},h.prototype.show=function(){this.$popup.fadeIn(function(){})},h.prototype.hide=function(t){s.log("Popup->hide");var e=this;this.$popup.fadeOut(function(){e.destroy(),t()})},h.prototype.destroy=function(){this.$popup&&this.$popup.length&&(this.$popup.remove(),this.$popup.find("video").length&&this.$popup.find("video")[0].pause()),delete this.$popup},s.Popup=h,s.PopupInappropriate=function(t,e){this.init(t,e)},e.extend(s.PopupInappropriate.prototype,{feed:null,post:null,init:function(t,i){var s=this;this.feed=i,this.post=t,this.jQueryel=e(".mark-bubble"),e(".mark-close").click(function(t){t.preventDefault(),e(this).parent().fadeOut("slow")}),e(".mark-bubble .submit").click(function(){var t=s.$el.find("input.text"),o=e.trim(t.val());o&&(t.disabled=!0,e(this).hide(),s.$el.find(".waiting").show(),i.inappropriatePost(s.post.id,o,function(){t.val(""),s.$el.find(".waiting").hide(),s.$el.find(".title").html("Thank you"),s.$el.find("input.text").hide(),s.$el.find("input.text").html(""),s.$el.find(".success-message").html("This message has been marked as inappropriate").show()},function(){s.$el.find(".waiting").hide(),s.$el.find(".title").html("Oops"),s.$el.find("input.text").hide(),s.$el.find("input.text").html(""),s.$el.find(".success-message").html("It looks like a problem has occurred. Please try again later").show()}))}),this.$el.fadeIn("slow")}});var d=function(t){s.log("PopupManager->init "),this.widget=t;var i=this.widget.options.templatePopupWrapper;this.$wrapper=s.Template.render(i,{}),this.$popupContainer=this.$wrapper.find(".crt-popup-container"),this.$underlay=this.$wrapper.find(".crt-popup-underlay"),e("body").append(this.$wrapper),this.$underlay.click(this.onUnderlayClick.bind(this))};d.prototype.showPopup=function(t){var e=this;this.popup?this.popup.hide(function(){e.popup.destroy(),e.showPopup2(t)}):this.showPopup2(t)},d.prototype.showPopup2=function(t){var i=this;this.popup=new s.Popup(this,t,this.widget),this.$popupContainer.append(this.popup.$popup),this.$wrapper.show(),"block"!==this.$underlay.css("display")&&this.$underlay.fadeIn(),this.popup.show(),e("body").addClass("crt-popup-visible"),this.currentPostNum=0;for(var o=0;o<this.posts.length;o++)if(t.json.id==i.posts[o].id){i.currentPostNum=o,s.log("Found post "+o);break}this.widget.track("popup:show")},d.prototype.setPosts=function(t){this.posts=t},d.prototype.onClose=function(){this.hide()},d.prototype.onPrevious=function(){this.currentPostNum-=1,this.currentPostNum=this.currentPostNum>=0?this.currentPostNum:this.posts.length-1,this.showPopup({json:this.posts[this.currentPostNum]})},d.prototype.onNext=function(){this.currentPostNum+=1,this.currentPostNum=this.currentPostNum<this.posts.length?this.currentPostNum:0,this.showPopup({json:this.posts[this.currentPostNum]})},d.prototype.onUnderlayClick=function(t){s.log("PopupManager->onUnderlayClick"),t.preventDefault(),this.popup&&this.popup.hide(function(){this.hide()}.bind(this))},d.prototype.hide=function(){var t=this;s.log("PopupManager->hide"),this.widget.track("popup:hide"),e("body").removeClass("crt-popup-visible"),this.currentPostNum=0,this.popup=null,this.$underlay.fadeOut(function(){t.$underlay.css({display:"",opacity:""}),t.$wrapper.hide()})},d.prototype.destroy=function(){this.$underlay.remove(),delete this.$popup,delete this.$underlay},s.PopupManager=d;var f=function(t){function i(e,i,o){var r=this;t.call(this),this.options=i,this.widget=o;var n=this.widget.options.templatePost;if(this.json=e,this.$el=s.Template.render(n,e),this.$el.find(".crt-share-facebook").click(this.onShareFacebookClick.bind(this)),this.$el.find(".crt-share-twitter").click(this.onShareTwitterClick.bind(this)),this.$el.find(".crt-post-read-more-button").click(this.onReadMoreClick.bind(this)),this.$el.click(this.onPostClick.bind(this)),this.$post=this.$el.find(".crt-post-c"),this.$image=this.$el.find(".crt-post-image"),this.$imageContainer=this.$el.find(".crt-image-c"),this.$image.css({opacity:0}),this.json.image?(this.$image.on("load",this.onImageLoaded.bind(this)),this.$image.on("error",this.onImageError.bind(this))):setTimeout(function(){r.setHeight()},100),this.json.image_width>0){var a=this.json.image_height/this.json.image_width*100;this.$imageContainer.addClass("crt-image-responsive").css("padding-bottom",a+"%")}0!==this.json.url.indexOf("http")&&this.$el.find(".crt-post-share").hide(),this.$image.data("dims",this.json.image_width+":"+this.json.image_height),this.$post=this.$el.find(".crt-post"),this.json.video&&this.$post.addClass("has-video")}return t&&(i.__proto__=t),i.prototype=Object.create(t&&t.prototype),i.prototype.constructor=i,i.prototype.onShareFacebookClick=function(t){return t.preventDefault(),s.SocialFacebook.share(this.json),this.widget.track("share:facebook"),!1},i.prototype.onShareTwitterClick=function(t){return t.preventDefault(),s.SocialTwitter.share(this.json),this.widget.track("share:twitter"),!1},i.prototype.onPostClick=function(t){s.log("Post->click");var i=e(t.target);i.is("a")&&"#"!==i.attr("href")?this.widget.track("click:link"):(t.preventDefault(),this.trigger(s.Events.POST_CLICK,this,this.json,t))},i.prototype.onImageLoaded=function(){this.$image.animate({opacity:1}),this.setHeight(),this.trigger(s.Events.POST_IMAGE_LOADED,this)},i.prototype.onImageError=function(){this.$image.hide(),this.setHeight()},i.prototype.setHeight=function(){var t=this.$post.height();this.options.maxHeight&&this.options.maxHeight>0&&t>this.options.maxHeight&&this.$post.css({maxHeight:this.options.maxHeight}).addClass("crt-post-max-height"),this.layout()},i.prototype.layout=function(){this.layoutFooter()},i.prototype.layoutFooter=function(){var t=this.$el.find(".crt-post-username"),e=this.$el.find(".crt-date"),i=this.$el.find(".crt-post-footer"),s=this.$el.find(".crt-post-share"),o=this.$el.find(".crt-post-userimage"),r=i.width();t.width()+e.width()+s.width()+o.width()+40>r&&t.hide()},i.prototype.onReadMoreClick=function(t){t.preventDefault(),this.widget.track("click:read-more"),this.trigger(s.Events.POST_CLICK_READ_MORE,this,this.json,t)},i}(o);s.Post=f,s.Utils={postUrl:function(t){return t.url&&""!==t.url&&"''"!==t.url?t.url:(console.log(t.url),t.network_id+""=="1"?"https://twitter.com/"+t.user_screen_name+"/status/"+t.source_identifier:"")},center:function(t,e,i){var s=window.screen,o=i||{},r=o.height||s.height,n=o.width||s.height;return{top:r?(r-e)/2:0,left:n?(n-t)/2:0}},popup:function(t,e,i,s,o){var r=this.center(i,s),n="height="+s+",width="+i+",top="+r.top+",left="+r.left+",scrollbars="+o+",resizable";window.open(t,e,n)},tinyparser:function(t,e){return t.replace(/\{\{(.*?)\}\}/g,function(t,i){return e&&void 0!==e[i]?encodeURIComponent(e[i]):""})},debounce:function(t,e,i){var s;return function(){var o=this,r=arguments,n=function(){s=null,i||t.apply(o,r)},a=i&&!s;clearTimeout(s),s=setTimeout(n,e),a&&t.apply(o,r)}},uId:function(){return"_"+Math.random().toString(36).substr(2,9)}},s.DateUtils={dateFromString:function(t){dtstr=t.replace(/\D/g," ");var e=dtstr.split(" ");return e[1]--,new Date(Date.UTC(e[0],e[1],e[2],e[3],e[4],e[5]))},dateAsDayMonthYear:function(t){var e=new Date(parseInt(t,10)),i=e.getDate()+"",s=e.getMonth()+1+"",o=e.getFullYear()+"";return i=1===i.length?"0"+i:i,s=1===s.length?"0"+s:s,i+"/"+s+"/"+o},dateAsTimeArray:function(t){var e,i=new Date(parseInt(t,10)),s=i.getHours()+"",o=i.getMinutes()+"";return s>=12?(e="PM",s>12&&(s=s-12+"")):e="AM",s=1===s.length?"0"+s:s,o=1===o.length?"0"+o:o,[parseInt(s.charAt(0),10),parseInt(s.charAt(1),10),parseInt(o.charAt(0),10),parseInt(o.charAt(1),10),e]}},s.StringUtils={camelize:function(t){return t.replace(/(?:^|[-_])(\w)/g,function(t,e){return e?e.toUpperCase():""})},twitterLinks:function(t){return t=t.replace(/[@]+[A-Za-z0-9-_]+/g,function(t){var e=t.replace("@","");return s.StringUtils.url("https://twitter.com/"+e,t)}),t=t.replace(twttr.txt.regexen.validHashtag,function(t){var e=t.replace("#","%23");return s.StringUtils.url("https://twitter.com/search?q="+e,t)})},instagramLinks:function(t){return t=t.replace(/[@]+[A-Za-z0-9-_\.]+/g,function(t){var e=t.replace("@","");return s.StringUtils.url("https://www.instagram.com/"+e+"/",t)}),t=t.replace(twttr.txt.regexen.validHashtag,function(t){var e=t.replace("#","");return s.StringUtils.url("https://www.instagram.com/explore/tags/"+e+"/",t)})},facebookLinks:function(t){return t=t.replace(/[@]+[A-Za-z0-9-_]+/g,function(t){var e=t.replace("@","");return s.StringUtils.url("https://www.facebook.com/"+e+"/",t)}),t=t.replace(/[#]+[A-Za-z0-9-_]+/g,function(t){var e=t.replace("#","%23");return s.StringUtils.url("https://www.facebook.com/search/top/?q="+e,t)})},linksToHref:function(t){return t=t.replace(/[A-Za-z]+:\/\/[A-Za-z0-9-_]+\.[A-Za-z0-9-_:%&~\?\/.=]+/g,function(t){return s.StringUtils.url(t)})},url:function(t,e){return e=e||t,'<a href="'+t+'" target="_blank">'+e+"</a>"},youtubeVideoId:function(t){var e=t.match(/^.*((youtu.be\/)|(v\/)|(\/u\/\w\/)|(embed\/)|(watch\?))\??v?=?([^#\&\?]*).*/);if(e&&11==e[7].length)return e[7];var i=t.match(/^.*((youtu.be\/)|(v\/)|(\/u\/\w\/)|(embed\/))([^#\&\?]*).*/);return!(!i||11!=i[6].length)&&i[6]},vimeoVideoId:function(t){var e=t.match(/(?:www\.|player\.)?vimeo.com\/(?:channels\/(?:\w+\/)?|groups\/(?:[^\/]*)\/videos\/|album\/(?:\d+)\/video\/|video\/|)(\d+)(?:[a-zA-Z0-9_\-]+)?/);return console.log(e),!!(e&&e.length>=2)&&e[1]},filterHtml:function(t){try{var e=document.createElement("div");e.innerHTML=t;return e.textContent||e.innerText||""}catch(e){return t}},nl2br:function(t){return t=t.trim(),t=t.replace(/(?:\r\n|\r|\n)/g,"<br />")}};var g=function(t){function i(){s.log("Widget->construct"),t.call(this),this.id=s.Utils.uId()}return t&&(i.__proto__=t),i.prototype=Object.create(t&&t.prototype),i.prototype.constructor=i,i.prototype.setOptions=function(t,i){return this.options=e.extend(!0,{},i,t),t.debug&&(s.debug=!0),!0},i.prototype.init=function(){return!!s.checkContainer(this.options.container)&&(this.$container=e(this.options.container),this.$container.addClass("crt-feed"),this.createFeed(),this.createFilter(),this.createPopupManager(),!0)},i.prototype.createFeed=function(){this.feed=new s.Feed(this),this.feed.on(s.Events.POSTS_LOADED,this.onPostsLoaded.bind(this)),this.feed.on(s.Events.POSTS_FAILED,this.onPostsFail.bind(this)),this.feed.on(s.Events.FEED_LOADED,this.onFeedLoaded.bind(this))},i.prototype.createPopupManager=function(){this.popupManager=new s.PopupManager(this)},i.prototype.createFilter=function(){s.log("Widget->createFilter"),s.log(this.options.filter),this.options.filter&&(this.options.filter.showNetworks||this.options.filter.showSources)&&(this.filter=new s.Filter(this))},i.prototype.loadPosts=function(t){this.feed.loadPosts(t)},i.prototype.createPostElements=function(t){var i=this,s=[];return e(t).each(function(){var t=i.createPostElement(this);s.push(t.$el)}),s},i.prototype.createPostElement=function(t){var e=new s.Post(t,this.options,this);return e.on(s.Events.POST_CLICK,this.onPostClick.bind(this)),e.on(s.Events.POST_CLICK_READ_MORE,this.onPostClick.bind(this)),e.on(s.Events.POST_IMAGE_LOADED,this.onPostImageLoaded.bind(this)),this.trigger(s.Events.POST_CREATED,e),e},i.prototype.onPostsLoaded=function(t,e){s.log("Widget->onPostsLoaded"),s.log(e)},i.prototype.onPostsFail=function(t,e){s.log("Widget->onPostsLoadedFail"),s.log(e)},i.prototype.onPostClick=function(t,e,i){s.log("Widget->onPostClick"),s.log(t),s.log(i),this.options.showPopupOnClick&&this.popupManager.showPopup(e)},i.prototype.onPostImageLoaded=function(t,e){s.log("Widget->onPostImageLoaded")},i.prototype.onFeedLoaded=function(t,e){e.account.plan.unbranded||this.$container.addClass("crt-feed-branded")},i.prototype.track=function(t){s.log("Feed->track "+t),s.ajax(this.getUrl("/track/"+this.options.feedId),{a:t},function(t){s.log("Feed->track success"),s.log(t)},function(t,e,i){s.log("Feed->_loadPosts fail"),s.log(e),s.log(i)})},i.prototype.getUrl=function(t){return this.options.apiEndpoint+t},i.prototype.destroy=function(){s.log("Widget->destroy"),t.prototype.destroy.call(this),this.feed&&this.feed.destroy(),this.filter&&this.filter.destroy(),this.popupManager&&this.popupManager.destroy(),this.$container.removeClass("crt-feed")},i}(o);s.Widget=g,s.Config.Carousel=e.extend({},s.Config.Defaults,{scroll:"more",carousel:{autoPlay:!0,autoLoad:!0,infinite:!1}});var A=function(t){function i(i){var o=this;t.call(this),i.postsPerPage=30,this.setOptions(i,s.Config.Carousel),this.containerHeight=0,this.loading=!1,this.posts=[],this.firstLoad=!0,s.log("Carousel->init with options:"),s.log(this.options),this.init(this)&&(this.allLoaded=!1,this.$feed=e('<div class="crt-carousel-feed"></div>').appendTo(this.$container),this.$container.addClass("crt-carousel"),this.carousel=new s.UI.Layout.Carousel(this.$feed,this.options.carousel),this.carousel.on(s.Events.CAROUSEL_CHANGED,this.onCarouselChange.bind(this)),this.on(s.Events.FILTER_CHANGED,function(t){o.$feed.find(".crt-post").remove()}),this.loadPosts(0))}return t&&(i.__proto__=t),i.prototype=Object.create(t&&t.prototype),i.prototype.constructor=i,i.prototype.loadMorePosts=function(){s.log("Carousel->loadMorePosts"),this.feed.postCount>this.feed.postsLoaded&&this.feed.loadPosts(this.feed.currentPage+1)},i.prototype.onPostsLoaded=function(t,i){if(s.log("Carousel->onPostsLoaded"),this.loading=!1,0===i.length)this.allLoaded=!0;else{var o=this,r=[];e(i).each(function(t){var e=o.createPostElement(this);r.push(e.$el),o.options.animate&&o.firstLoad&&(e.$el.css({opacity:0}),setTimeout(function(){console.log(t),e.$el.css({opacity:0}).animate({opacity:1})},100*t))}),this.carousel.add(r),this.carousel.update(),this.popupManager.setPosts(i),this.options.onPostsLoaded(this,i)}this.firstLoad=!1},i.prototype.onCarouselChange=function(t,e){this.options&&this.options.carousel.autoLoad&&e>=this.feed.postsLoaded-this.carousel.PANES_VISIBLE&&this.loadMorePosts()},i.prototype.destroy=function(){t.prototype.destroy.call(this),this.feed.destroy(),this.carousel.off(s.Events.CAROUSEL_CHANGED,this.onCarouselChange.bind(this)),this.carousel.destroy(),this.$feed.remove(),this.$container.removeClass("crt-carousel"),delete this.$feed,delete this.$container,delete this.options,delete this.feed.postsLoaded,delete this.loading,delete this.allLoaded,delete this.feed},i}(g);s.Carousel=A,s.Config.Custom=e.extend({},s.Config.Defaults,{});!function(t){function i(i){t.call(this),this.containerHeight=0,this.loading=!1,this.feed=null,this.$container=null,this.$feed=null,this.posts=[],this.totalPostsLoaded=0,this.allLoaded=!1,this.setOptions(i,s.Config.Custom),s.log("Panel->init with options:"),s.log(this.options),this.init(this)&&(this.$feed=e('<div class="crt-feed"></div>').appendTo(this.$container),this.$container.addClass("crt-custom"),this.loadPosts(0))}t&&(i.__proto__=t),i.prototype=Object.create(t&&t.prototype),i.prototype.constructor=i,i.prototype.onPostsLoaded=function(t,i){if(s.log("Custom->onPostsLoaded"),this.loading=!1,0===i.length)this.allLoaded=!0;else{var o=this,r=[];e(i).each(function(){var t=o.createPostElement(this);r.push(t.$el),o.$feed.append(t.$el)}),this.popupManager.setPosts(i),this.options.onPostsLoaded(this,i)}},i.prototype.onPostClick=function(t,e){this.popupManager.showPopup(e)},i.prototype.destroy=function(){t.prototype.destroy.call(this),this.feed.destroy(),this.$feed.remove(),this.$container.removeClass("crt-custom"),delete this.$feed,delete this.$container,delete this.options,delete this.totalPostsLoaded,delete this.loading,delete this.allLoaded,delete this.feed},i}(g);s.Config.Grid=e.extend({},s.Config.Defaults,{templatePost:"v2-grid-post",templateFeed:"v2-grid-feed",animate:!1,grid:{minWidth:200,rows:3}});var v=function(t){function i(e){if(t.call(this),this.setOptions(e,s.Config.Grid),s.log("Grid->init with options:"),s.log(this.options),this.containerHeight=0,this.loading=!1,this.feed=null,this.$container=null,this.$feed=null,this.posts=[],this.columnCount=0,this.rowsMax=0,this.totalPostsLoaded=0,this.allLoaded=!1,this.init(this)){var i=s.Template.render(this.options.templateFeed,{});this.$container.append(i),this.$feed=this.$container.find(".crt-feed"),this.$feedWindow=this.$container.find(".crt-feed-window"),this.$loadMore=this.$container.find(".crt-feed-more a"),this.$container.addClass("crt-grid"),this.options.grid.showLoadMore?(this.$feedWindow.css({position:"relative"}),this.$loadMore.click(this.onMoreClicked.bind(this))):this.$loadMore.hide(),this.createHandlers(),this.rowsMax=this.options.grid.rows,this.updateLayout()}}return t&&(i.__proto__=t),i.prototype=Object.create(t&&t.prototype),
i.prototype.constructor=i,i.prototype.loadPosts=function(){},i.prototype.updateLayout=function(){var t=Math.floor(this.$container.width()/this.options.grid.minWidth);t=t<1?1:t,this.$container.removeClass("crt-grid-col"+this.columnCount),this.columnCount=t,this.$container.addClass("crt-grid-col"+this.columnCount);var e=t*(this.rowsMax+1);if(e>this.feed.postsLoaded&&!this.feed.allPostsLoaded){var i=e-this.feed.postsLoaded,s={limit:i};this.feed.pagination&&this.feed.pagination.after&&(s.after=this.feed.pagination.after),this.feed._loadPosts(s)}else this.updateHeight(!1)},i.prototype.updateHeight=function(t){var e=this.$container.find(".crt-post-c").width();this.$feedWindow.css({overflow:"hidden"});var i=Math.ceil(this.feed.postCount/this.columnCount),s=this.rowsMax<i?this.rowsMax:i;t?this.$feedWindow.animate({height:s*e}):this.$feedWindow.height(s*e),this.options.grid.showLoadMore&&(this.feed.allPostsLoaded?this.$loadMore.hide():this.$loadMore.show())},i.prototype.createHandlers=function(){var t=this,i=this.id,o=s.Utils.debounce(function(){t.updateLayout()},100);e(window).on("resize."+i,o),e(window).on("curatorCssLoaded."+i,o),e(document).on("ready."+i,o)},i.prototype.destroyHandlers=function(){var t=this.id;e(window).off("resize."+t),e(window).off("curatorCssLoaded."+t),e(document).off("ready."+t)},i.prototype.onPostsLoaded=function(t,e){var i=this;if(s.log("Grid->onPostsLoaded"),this.loading=!1,0===e.length)this.allLoaded=!0;else{this.postElements=[];for(var o=0,r=0,n=e;r<n.length;r+=1)!function(){var t=n[r],e=i.createPostElement(t);i.postElements.push(e),i.$feed.append(e.$el),e.layout(),i.options.animate&&(e.$el.css({opacity:0}),setTimeout(function(){e.$el.css({opacity:0}).animate({opacity:1})},100*o),o++)}();this.popupManager.setPosts(e),this.options.onPostsLoaded(this,e),this.updateHeight(!0)}},i.prototype.onMoreClicked=function(t){t.preventDefault();var e=1;this.columnCount<=1?e=4:2===this.columnCount&&(e=2),this.rowsMax+=e,this.updateLayout()},i.prototype.destroy=function(){t.prototype.destroy.call(this),this.feed.destroy(),this.destroyHandlers(),this.$container.empty().removeClass("crt-grid").removeClass("crt-grid-col"+this.columnCount).css({height:"",overflow:""}),delete this.$feed,delete this.$container,delete this.options,delete this.totalPostsLoaded,delete this.loading,delete this.allLoaded,delete this.feed},i}(g);s.Grid=v,s.Config.Panel=e.extend({},s.Config.Defaults,{panel:{autoPlay:!0,autoLoad:!0,moveAmount:1,fixedHeight:!1,infinite:!0,minWidth:2e3}});var m=function(t){function i(i){t.call(this),this.setOptions(i,s.Config.Panel),s.log("Panel->init with options:"),s.log(this.options),this.containerHeight=0,this.loading=!1,this.feed=null,this.$container=null,this.$feed=null,this.posts=[],this.init(this)&&(this.allLoaded=!1,this.$feed=e('<div class="crt-feed"></div>').appendTo(this.$container),this.$container.addClass("crt-carousel"),this.$container.addClass("crt-panel"),this.options.panel.fixedHeight&&this.$container.addClass("crt-panel-fixed-height"),this.carousel=new s.UI.Layout.Carousel(this.$feed,this.options.panel),this.carousel.on(s.Events.CAROUSEL_CHANGED,this.onCarouselChange.bind(this)),this.loadPosts(0))}return t&&(i.__proto__=t),i.prototype=Object.create(t&&t.prototype),i.prototype.constructor=i,i.prototype.loadMorePosts=function(){s.log("Panel->loadMorePosts"),this.feed.loadPosts(this.feed.currentPage+1)},i.prototype.onPostsLoaded=function(t,i){if(s.log("Panel->onPostsLoaded"),this.loading=!1,0===i.length)this.allLoaded=!0;else{var o=this,r=[];e(i).each(function(){var t=o.createPostElement(this);r.push(t.$el)}),this.carousel.add(r),this.carousel.update(),this.popupManager.setPosts(i),this.options.onPostsLoaded(this,i)}},i.prototype.onPostImageLoaded=function(t,e){s.log("Panel->onPostImageLoaded"),this.carousel.updateHeight()},i.prototype.onCarouselChange=function(t,e){this.options&&this.options.panel.autoLoad&&e>=this.feed.postsLoaded-4&&this.loadMorePosts()},i.prototype.destroy=function(){t.prototype.destroy.call(this),this.feed.destroy(),this.carousel.off(s.Events.CAROUSEL_CHANGED,this.onCarouselChange.bind(this)),this.carousel.destroy(),this.$feed.remove(),this.$container.removeClass("crt-panel"),this.$container.removeClass("crt-carousel"),delete this.$feed,delete this.$container,delete this.options,delete this.feed.postsLoaded,delete this.loading,delete this.allLoaded,delete this.feed},i}(g);s.Panel=m,s.Config.Waterfall=e.extend({},s.Config.Defaults,{scroll:"more",waterfall:{gridWidth:300,animate:!0,animateSpeed:400}});var C=function(t){function i(i){var o=this;t.call(this),this.setOptions(i,s.Config.Waterfall),s.log("Waterfall->init with options:"),s.log(this.options),this.init(this)&&(this.$scroll=e('<div class="crt-feed-scroll"></div>').appendTo(this.$container),this.$feed=e('<div class="crt-feed"></div>').appendTo(this.$scroll),this.$container.addClass("crt-feed-container"),"continuous"===this.options.scroll?e(this.$scroll).scroll(function(){var t=o.$scroll.height(),e=o.$feed.height();o.$scroll.scrollTop()>=e-t&&o.loadMorePosts()}):"none"===this.options.scroll||(this.$more=e('<div class="crt-feed-more"><a href="#"><span>Load more</span></a></div>').appendTo(this.$scroll),this.$more.find("a").on("click",function(t){t.preventDefault(),o.loadMorePosts()})),this.ui=new s.UI.Layout.Waterfall({selector:".crt-post-c",gutter:0,width:this.options.waterfall.gridWidth,animate:this.options.waterfall.animate,animationOptions:{speed:this.options.waterfall.animateSpeed/2,duration:this.options.waterfall.animateSpeed}},this.$feed),this.on(s.Events.FILTER_CHANGED,function(t){o.$feed.find(".crt-post").remove()}),this.feed.load())}return t&&(i.__proto__=t),i.prototype=Object.create(t&&t.prototype),i.prototype.constructor=i,i.prototype.loadMorePosts=function(){s.log("Waterfall->loadMorePosts"),this.feed.loadAfter()},i.prototype.loadPage=function(t){s.log("Waterfall->loadPage"),this.$feed.find(".crt-post").remove(),this.feed.loadPosts(t)},i.prototype.onPostsLoaded=function(t,i){s.log("Waterfall->onPostsLoaded");var o=this.createPostElements(i);this.ui.append(o);var r=this;e.each(o,function(t){var e=this;r.options.waterfall.showReadMore&&e.find(".crt-post").addClass("crt-post-show-read-more")}),this.feed.allPostsLoaded&&this.$more&&this.$more.hide(),this.popupManager.setPosts(i),this.loading=!1,this.options.onPostsLoaded(this,i)},i.prototype.destroy=function(){s.log("Waterfall->destroy"),t.prototype.destroy.call(this),this.feed.destroy(),this.ui.destroy(),this.$feed.remove(),this.$scroll.remove(),this.$more&&this.$more.remove(),this.$container.removeClass("crt-feed-container"),delete this.$feed,delete this.$scroll,delete this.$container,delete this.options,delete this.totalPostsLoaded,delete this.loading,delete this.allLoaded,delete this.feed},i}(g);return s.Waterfall=C,s});