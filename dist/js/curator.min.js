!function(t,e){if("function"==typeof define&&define.amd){var i=function(){var i=[].slice.call(arguments);return i.unshift(t),e.apply(this,i)};define(["jquery","curator"],i)}else"object"==typeof exports?module.exports=e(t,require("jquery")):t.Curator=e(t,t.jQuery||t.Zepto)}(this,function(t,e){function i(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function s(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}if(void 0==e)return window.alert("jQuery not found\n\nThe Curator Widget is running in dependency mode - this requires jQuery of Zepto. Try disabling DEPENDENCY MODE in the Admin on the Publish page."),!1;var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},a=function(){function t(t,e){for(var i=0;i<e.length;i++){var s=e[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}return function(e,i,s){return i&&t(e.prototype,i),s&&t(e,s),e}}();!function(t,e){var i=function(t,e,i){var s;return function(){function o(){i||t.apply(n,a),s=null}var n=this,a=arguments;s?clearTimeout(s):i&&t.apply(n,a),s=setTimeout(o,e||150)}};t.fn[e]=function(t){return t?this.bind("resize",i(t)):this.trigger(e)}}(e,"smartresize"),function(t){var e={selector:".item",width:225,gutter:20,animate:!1,animationOptions:{speed:200,duration:300,effect:"fadeInOnAppear",queue:!0,complete:function(){}}},i=function(){function i(e,s){o(this,i),this.element=t(s),this._init(e)}return a(i,[{key:"_init",value:function(i){var s=this;this.name=this._setName(5),this.gridArr=[],this.gridArrAppend=[],this.gridArrPrepend=[],this.setArr=!1,this.setGrid=!1,this.cols=0,this.itemCount=0,this.isPrepending=!1,this.appendCount=0,this.resetCount=!0,this.ifCallback=!0,this.box=this.element,this.boxWidth=this.box.width(),this.options=t.extend(!0,{},e,i),this.gridArr=t.makeArray(this.box.find(this.options.selector)),this.isResizing=!1,this.w=0,this.boxArr=[],this._setCols(),this._renderGrid("append"),t(this.box).addClass("gridalicious"),t(window).smartresize(function(){s.resize()})}},{key:"_setName",value:function(t,e){return e=e?e:"",t?this._setName(--t,"0123456789ABCDEFGHIJKLMNOPQRSTUVWXTZabcdefghiklmnopqrstuvwxyz".charAt(Math.floor(60*Math.random()))+e):e}},{key:"_setCols",value:function(){this.cols=Math.floor(this.box.width()/this.options.width),this.cols<1&&(this.cols=1),diff=(this.box.width()-this.cols*this.options.width-this.options.gutter)/this.cols,w=(this.options.width+diff)/this.box.width()*100,this.w=w,this.colHeights=new Array(this.cols),this.colHeights.fill(0),this.colItems=new Array(this.cols),this.colItems.fill([]);for(var e=0;e<this.cols;e++){var i=t("<div></div>").addClass("galcolumn").attr("id","item"+e+this.name).css({width:w+"%",paddingLeft:this.options.gutter,paddingBottom:this.options.gutter,float:"left","-webkit-box-sizing":"border-box","-moz-box-sizing":"border-box","-o-box-sizing":"border-box","box-sizing":"border-box"});this.box.append(i)}}},{key:"_renderGrid",value:function(e,i,s,o){var n=[],a=[],r=0,l=this.appendCount,c=(this.options.gutter,this.cols),h=this.name;t(".galcolumn").width();i?(a=i,"append"==e&&(l+=s,r=this.appendCount),"prepend"==e&&(this.isPrepending=!0,r=Math.round(s%c),r<=0&&(r=c)),"renderAfterPrepend"==e&&(l+=s,r=s)):(a=this.gridArr,l=t(this.gridArr).size());var d=!0,p=!1,u=void 0;try{for(var f,g=a[Symbol.iterator]();!(d=(f=g.next()).done);d=!0){var v=f.value,m="100%";v.hasClass("not-responsive")&&(m="auto"),v.css({zoom:"1",filter:"alpha(opacity=0)",opacity:"0"});for(var y=0,w=1;w<this.colHeights.length;w++)this.colHeights[w]<this.colHeights[y]&&(y=w);"prepend"==e?(t("#item"+y+h).prepend(v),n.push(v)):(t("#item"+y+h).append(v),n.push(v),l>=c&&(l-=c)),this.colItems[y].push(v),this.colHeights[y]+=v.height()}}catch(t){p=!0,u=t}finally{try{!d&&g.return&&g.return()}finally{if(p)throw u}}this.appendCount=l,"append"==e||"prepend"==e?("prepend"==e&&this._updateAfterPrepend(this.gridArr,a),this._renderItem(n),this.isPrepending=!1):this._renderItem(this.gridArr)}},{key:"_collectItems",value:function(){var e=[];return t(this.box).find(this.options.selector).each(function(i){e.push(t(this))}),e}},{key:"_renderItem",value:function(e){var i=this.options.animationOptions.speed,s=this.options.animationOptions.effect,o=this.options.animationOptions.duration,n=this.options.animationOptions.queue,a=this.options.animate,r=this.options.animationOptions.complete,l=0,c=0;a!==!0||this.isResizing?(t.each(e,function(e,i){t(i).css({opacity:"1",filter:"alpha(opacity=100)"})}),this.ifCallback&&r.call(e)):(n===!0&&"fadeInOnAppear"==s?(this.isPrepending&&e.reverse(),t.each(e,function(s,n){setTimeout(function(){t(n).animate({opacity:"1.0"},o),c++,c==e.length&&r.call(void 0,e)},l*i),l++})):n===!1&&"fadeInOnAppear"==s&&(this.isPrepending&&e.reverse(),t.each(e,function(i,s){t(s).animate({opacity:"1.0"},o),c++,c==e.length&&this.ifCallback&&r.call(void 0,e)})),n!==!0||s||t.each(e,function(i,s){t(s).css({opacity:"1",filter:"alpha(opacity=100)"}),c++,c==e.length&&this.ifCallback&&r.call(void 0,e)}))}},{key:"_updateAfterPrepend",value:function(e,i){var s=this.gridArr;t.each(i,function(t,e){s.unshift(e)}),this.gridArr=s}},{key:"resize",value:function(){if(this.box.width()!==this.boxWidth){var e=Math.floor(this.box.width()/this.options.width);this.cols!==e&&(this.box.find(t(".galcolumn")).remove(),this._setCols(),this.ifCallback=!1,this.isResizing=!0,this._renderGrid("append"),this.ifCallback=!0,this.isResizing=!1,this.boxWidth=this.box.width())}}},{key:"append",value:function(e){var i=this.gridArr,s=this.gridArrPrepend;t.each(e,function(t,e){i.push(e),s.push(e)}),this._renderGrid("append",e,t(e).size())}},{key:"prepend",value:function(e){this.ifCallback=!1,this._renderGrid("prepend",e,t(e).size()),this.ifCallback=!0}}]),i}();t.fn.waterfall=function(e,s){return"string"==typeof e?this.each(function(){var i=t.data(this,"WaterfallRender");i[e].apply(i,[s])}):this.each(function(){t.data(this,"WaterfallRender",new i(e,this))}),this}}(e);var r=function(){},l=Array.prototype.slice,c=function(t,e){var i=r.prototype="function"==typeof t?t.prototype:t,s=new r,o=e.apply(s,l.call(arguments,2).concat(i));if("object"===("undefined"==typeof o?"undefined":n(o)))for(var a in o)s[a]=o[a];if(!s.hasOwnProperty("constructor"))return s;var c=s.constructor;return c.prototype=s,c};if(c.defclass=function(t){var e=t.constructor;return e.prototype=t,e},c.extend=function(t,e){return c(t,function(t){return this.uber=t,e})},function(){var e={},i={networkIcon:function(){return this.data.network_name.toLowerCase()},networkName:function(){return this.data.network_name.toLowerCase()},userUrl:function(){if(this.data.user_url&&""!=this.data.user_url)return this.data.user_url;if(this.data.originator_user_url&&""!=this.data.originator_user_url)return this.data.originator_user_url;if(this.data.userUrl&&""!=this.data.userUrl)return this.data.userUrl;var t=this.data.network_id+"";return"1"===t?"http://twitter.com/"+this.data.user_screen_name:"2"===t?"http://instagram.com/"+this.data.user_screen_name:"3"===t?"http://facebook.com/"+this.data.user_screen_name:"#"},parseText:function(t){return this.data.is_html?t:("Twitter"===this.data.network_name?(t=v.StringUtils.linksToHref(t),t=v.StringUtils.twitterLinks(t)):"Instagram"===this.data.network_name?(t=v.StringUtils.linksToHref(t),t=v.StringUtils.instagramLinks(t)):"Facebook"===this.data.network_name?(t=v.StringUtils.linksToHref(t),t=v.StringUtils.facebookLinks(t)):t=v.StringUtils.linksToHref(t),i.nl2br(t))},nl2br:function(t){return t=t.trim(),t=t.replace(/(?:\r\n|\r|\n)/g,"<br />")},contentImageClasses:function(){return this.data.image?"crt-post-has-image":"crt-post-content-image-hidden"},contentTextClasses:function(){return this.data.text?"crt-post-has-text":"crt-post-content-text-hidden"},fuzzyDate:function(t){var e,i=Date.parse(t+" UTC"),s=Math.round((new Date-i)/1e3),o=60,n=60*o,a=24*n,r=7*a,l=30*a;return e=s<30?"Just now":s<o?s+" seconds ago":s<2*o?"a minute ago.":s<n?Math.floor(s/o)+" minutes ago":1==Math.floor(s/n)?"1 hour ago.":s<a?Math.floor(s/n)+" hours ago":s<2*a?"Yesterday":s<r?"This week":s<2*r?"Last week":s<l?"This month":i},prettyDate:function(t){var e=v.DateUtils.dateFromString(t),i=((new Date).getTime()-e.getTime())/1e3,s=Math.floor(i/86400),o=e.getFullYear(),n=e.getMonth()+1,a=e.getDate();if(isNaN(s)||s<0||s>=31)return o.toString()+"-"+(n<10?"0"+n.toString():n.toString())+"-"+(a<10?"0"+a.toString():a.toString());var r=0==s&&(i<60&&"just now"||i<120&&"1 minute ago"||i<3600&&Math.floor(i/60)+" minutes ago"||i<7200&&"1 hour ago"||i<86400&&Math.floor(i/3600)+" hours ago")||1==s&&"Yesterday"||s<7&&s+" days ago"||s<31&&Math.ceil(s/7)+" weeks ago";return r}};t.parseTemplate=function(t,s){var o="";try{var n=e[t];if(!n){var a=t.replace(/[\r\t\n]/g," ").replace(/'(?=[^%]*%>)/g,"\t").split("'").join("\\'").split("\t").join("'").replace(/<%=(.+?)%>/g,"',$1,'").split("<%").join("');").split("%>").join("p.push('"),r="var p=[],print=function(){p.push.apply(p,arguments);};with(obj){p.push('"+a+"');}return p.join('');";n=new Function("obj",r),e[t]=n}return i.data=s,n.call(i,s)}catch(t){window.console.log("Template parse error: "+t.message),o=t.message}return" # ERROR: "+o+" # "}}(),!e.support.cors&&e.ajaxTransport&&window.XDomainRequest){var h=/^https?:\/\//i,d=/^get|post$/i,p=new RegExp("^"+window.location.protocol,"i"),u=/text\/html/i,f=/\/json/i,g=/\/xml/i;e.ajaxTransport("text html xml json",function(t,i,s){if(s=s,t.crossDomain&&t.async&&d.test(t.type)&&h.test(t.url)&&p.test(t.url)){var o=null,n=(i.dataType||"").toLowerCase();return{send:function(s,a){o=new window.XDomainRequest,/^\d+$/.test(i.timeout)&&(o.timeout=i.timeout),o.ontimeout=function(){a(500,"timeout")},o.onload=function(){var t="Content-Length: "+o.responseText.length+"\r\nContent-Type: "+o.contentType,i={code:200,message:"success"},s={text:o.responseText};try{if("html"===n||u.test(o.contentType))s.html=o.responseText;else if("json"===n||"text"!==n&&f.test(o.contentType))try{s.json=e.parseJSON(o.responseText)}catch(t){i.code=500,i.message="parseerror"}else if("xml"===n||"text"!==n&&g.test(o.contentType)){var r=new window.ActiveXObject("Microsoft.XMLDOM");r.async=!1;try{r.loadXML(o.responseText)}catch(t){r=void 0}if(!r||!r.documentElement||r.getElementsByTagName("parsererror").length)throw i.code=500,i.message="parseerror","Invalid XML: "+o.responseText;s.xml=r}}catch(t){throw t}finally{a(i.code,i.message,s,t)}},o.onprogress=function(){},o.onerror=function(){a(500,"error",{text:o.responseText})};var r="";i.data&&(r="string"===e.type(i.data)?i.data:e.param(i.data)),o.open(t.type,t.url),o.send(r)},abort:function(){o&&o.abort()}}}})}var v={debug:!1,SOURCE_TYPES:["twitter","instagram"],log:function(t){window.console&&v.debug&&window.console.log(t)},alert:function(t){window.alert&&window.alert(t)},checkContainer:function(t){return v.log("Curator->checkContainer: "+t),0!==e(t).length||(window.console&&window.console.log("Curator could not find the element "+t+". Please ensure this element existings in your HTML code. Exiting."),!1)},checkPowered:function(t){v.log("Curator->checkPowered");var e=t.html();return e.indexOf("Curator")>0||(v.alert("Container is missing Powered by Curator"),!1)},loadCSS:function(t){try{var e=v.createSheet(t),i=".crt-post .crt-post-header, .crt-post .crt-post-header .social-icon",s=".crt-post .crt-post-header, .crt-post .crt-post-share, .crt-post .crt-post-header .crt-post-name a, .crt-post .crt-post-share a, .crt-post .crt-post-header .social-icon i",o=".crt-post",n=".crt-post .crt-post-content-text";v.addCSSRule(e,i,"background-color:"+t.colours.headerBg),v.addCSSRule(e,s,"color:"+t.colours.headerText),v.addCSSRule(e,o,"background-color:"+t.colours.bodyBg),v.addCSSRule(e,n,"color:"+t.colours.bodyText)}catch(t){console.log("CURATOR UNABLE TO LOAD CSS"),console.log(t.message)}},addCSSRule:function(t,e,i,s){"insertRule"in t?t.insertRule(e+"{"+i+"}",0):"addRule"in t&&t.addRule(e,i)},createSheet:function(){var t=document.createElement("style");return t.appendChild(document.createTextNode("")),document.head.appendChild(t),t.sheet},loadWidget:function(t,e){e&&(v.Templates.postTemplate=e);var i=window.Curator[t.type];window.curatorWidget=new i(t)},Templates:{},Config:{Defaults:{apiEndpoint:"https://api.curator.io/v1",feedId:"",postsPerPage:12,maxPosts:0,debug:!1,postTemplate:"#post-template",onPostsLoaded:function(){},filter:{show:!1,label:"Show:"}}},augment:c};void 0===e&&v.alert("Curator requires jQuery. \n\nPlease include jQuery in your HTML before the Curator widget script tag.\n\nVisit http://jquery.com/download/ to get the latest version");var m=function(){function t(){o(this,t),this.listeners={}}return a(t,[{key:"on",value:function(t,e,i){for(var s=[],o=arguments.length,n=0;n<o;n++)s.push(arguments[n]);s=s.length>3?s.splice(3,s.length-1):[],"undefined"!=typeof this.listeners[t]?this.listeners[t].push({scope:i,callback:e,args:s}):this.listeners[t]=[{scope:i,callback:e,args:s}]}},{key:"off",value:function(t,e,i){if("undefined"!=typeof this.listeners[t]){for(var s=this.listeners[t].length,o=[],n=0;n<s;n++){var a=this.listeners[t][n];a.scope==i&&a.callback==e||o.push(a)}this.listeners[t]=o}}},{key:"has",value:function(t,e,i){if("undefined"!=typeof this.listeners[t]){var s=this.listeners[t].length;if(void 0===e&&void 0===i)return s>0;for(var o=0;o<s;o++){var n=this.listeners[t][o];if((!i||n.scope==i)&&n.callback==e)return!0}}return!1}},{key:"trigger",value:function(t,e){for(var i=0,s={type:t,target:e},o=[],n=arguments.length,a=0;a<n;a++)o.push(arguments[a]);if(o=o.length>2?o.splice(2,o.length-1):[],o=[s].concat(o),"undefined"!=typeof this.listeners[t])for(var r=this.listeners[t].length,l=0;l<r;l++){var c=this.listeners[t][l];if(c&&c.callback){var h=o.concat(c.args);c.callback.apply(c.scope,h),i+=1}}}},{key:"getEvents",value:function(){var t="";for(var e in this.listeners)for(var i=this.listeners[e].length,s=0;s<i;s++){var o=this.listeners[e][s];t+=o.scope&&o.scope.className?o.scope.className:"anonymous",t+=" listen for '"+e+"'\n"}return t}}]),t}();v.EventBus=new m,function(t){function e(){return Math.random().toString(36).replace(/[^a-z]+/g,"").substr(0,5)}var i={circular:!1,speed:5e3,duration:700,minWidth:250,panesVisible:null,moveAmount:0,autoPlay:!1,useCss:!0};t.zepto&&(i.easing="ease-in-out");var s={viewport:{width:"100%",position:"relative"},pane_stage:{width:"100%",overflow:"hidden",position:"relative",height:0},pane_slider:{width:"0%","list-style":"none",position:"relative",overflow:"hidden",padding:"0",left:"0"},pane:{width:"0%",position:"relative",float:"left"}},n=function(){function e(n,a){var r=this;o(this,e),v.log("Carousel->construct"),this.current_position=0,this.animating=!1,this.timeout=null,this.FAKE_NUM=0,this.PANES_VISIBLE=0,this.options=t.extend([],i,a),this.$viewport=t(n),this.$panes=this.$viewport.children(),this.$panes.detach(),this.$pane_stage=t('<div class="ctr-carousel-stage"></div>').appendTo(this.$viewport),this.$pane_slider=t('<div class="ctr-carousel-slider"></div>').appendTo(this.$pane_stage),this.$viewport.css(s.viewport),this.$pane_slider.css(s.pane_slider),this.$pane_stage.css(s.pane_stage),this.addControls(),this.update(),t(window).smartresize(function(){r.resize(),r.move(r.current_position,!0),r.options.autoPlay&&r.animate()})}return a(e,[{key:"update",value:function(){this.$panes=this.$pane_slider.children(),this.NUM_PANES=this.options.circular?this.$panes.length+1:this.$panes.length,this.NUM_PANES>0&&(this.resize(),this.move(this.current_position,!0),this.animating||this.options.autoPlay&&this.animate())}},{key:"add",value:function(t){this.$pane_slider.append(t),this.$panes=this.$pane_slider.children()}},{key:"resize",value:function(){var e=this,i=this.options.infinite?100*(this.NUM_PANES+1)+"%":100*this.NUM_PANES+"%";if(this.$pane_slider.css({width:i}),this.VIEWPORT_WIDTH=this.$viewport.width(),this.options.panesVisible?(this.PANES_VISIBLE=this.options.panesVisible(),this.PANE_WIDTH=this.VIEWPORT_WIDTH/this.PANES_VISIBLE):(this.PANES_VISIBLE=this.VIEWPORT_WIDTH<this.options.minWidth?1:Math.floor(this.VIEWPORT_WIDTH/this.options.minWidth),this.PANE_WIDTH=this.VIEWPORT_WIDTH/this.PANES_VISIBLE),this.options.infinite){this.$panes.filter(".crt-clone").remove();for(var o=this.NUM_PANES-1;o>this.NUM_PANES-1-this.PANES_VISIBLE;o--){var n=this.$panes.eq(o).clone();n.addClass("crt-clone"),n.css("opacity","1"),n.find(".crt-post-image").css({opacity:1}),this.$pane_slider.prepend(n),this.FAKE_NUM=this.PANES_VISIBLE}this.$panes=this.$pane_slider.children()}this.$panes.each(function(i,o){t(o).css(t.extend(s.pane,{width:e.PANE_WIDTH+"px"}))})}},{key:"destroy",value:function(){}},{key:"animate",value:function(){var t=this;this.animating=!0,clearTimeout(this.timeout),this.timeout=setTimeout(function(){t.next()},this.options.speed)}},{key:"next",value:function(){var t=this.options.moveAmount?this.options.moveAmount:this.PANES_VISIBLE;this.move(this.current_position+t,!1)}},{key:"prev",value:function(){var t=this.options.moveAmount?this.options.moveAmount:this.PANES_VISIBLE;this.move(this.current_position-t,!1)}},{key:"move",value:function(t,e){var i=this;this.current_position=t;var s=this.NUM_PANES-this.PANES_VISIBLE;this.current_position<0?this.current_position=0:this.current_position>s&&(this.current_position=s);var o=this.FAKE_NUM+this.current_position,n=o*this.PANE_WIDTH,a=(this.PANES_VISIBLE,this.options.infinite?this.PANE_WIDTH*this.NUM_PANES:this.PANE_WIDTH*this.NUM_PANES-this.VIEWPORT_WIDTH);if(this.currentLeft=n,n<0?this.currentLeft=0:n>a?this.currentLeft=a:this.currentLeft=n,e)this.$pane_slider.css({left:0-this.currentLeft+"px"}),this.moveComplete();else{var r={duration:this.options.duration,complete:function(){i.moveComplete()}};this.options.easing&&(r.easing=this.options.easing),this.$pane_slider.animate({left:0-this.currentLeft+"px"},r)}}},{key:"moveComplete",value:function(){var e=this;this.options.infinite&&this.current_position>=this.NUM_PANES-this.PANES_VISIBLE&&(this.$pane_slider.css({left:0}),this.current_position=0-this.PANES_VISIBLE,this.currentLeft=0),setTimeout(function(){for(var i=0,s=e.current_position;s<e.current_position+e.PANES_VISIBLE;s++){var o=t(e.$panes[s]).children(".crt-post"),n=o.height();n>i&&(i=n),console.log(o),console.log(s+":"+n)}e.$pane_stage.animate({height:i},300)},50),this.$viewport.trigger("curatorCarousel:changed",[this,this.current_position]),this.options.autoPlay&&this.animate()}},{key:"addControls",value:function(){this.$viewport.append('<button type="button" data-role="none" class="crt-panel-prev crt-panel-arrow" aria-label="Previous" role="button" aria-disabled="false">Previous</button>'),this.$viewport.append('<button type="button" data-role="none" class="crt-panel-next crt-panel-arrow" aria-label="Next" role="button" aria-disabled="false">Next</button>'),this.$viewport.on("click",".crt-panel-prev",this.prev.bind(this)),this.$viewport.on("click",".crt-panel-next",this.next.bind(this))}},{key:"method",value:function(){var t=arguments[0];"update"==t?this.update():"add"==t?this.add(arguments[1]):"destroy"==t&&this.destroy()}}]),e}(),r={};t.extend(t.fn,{curatorCarousel:function(i){var s=1===arguments.length?[arguments[0]]:Array.apply(null,arguments);return t.each(this,function(o,a){var l=t(a).data("carousel");r[l]?r[l].method.apply(r[l],s):(l=e(),r[l]=new n(a,i),t(a).data("carousel",l))}),this}}),window.CCarousel=n}(e);var y=function(){function t(){o(this,t),v.log("Client->construct")}return a(t,[{key:"setOptions",value:function(t,i){return this.options=e.extend(!0,{},i,t),t.debug&&(v.debug=!0),!0}},{key:"init",value:function(){return!!v.checkContainer(this.options.container)&&(this.$container=e(this.options.container),this.createFeed(),this.createFilter(),this.createPopupManager(),!0)}},{key:"createFeed",value:function(){var t=this;this.feed=new v.Feed(this),this.feed.on("postsLoaded",function(e){t.onPostsLoaded(e.target)}),this.feed.on("postsFailed",function(e){t.onPostsFail(e.target)})}},{key:"createPopupManager",value:function(){this.popupManager=new v.PopupManager(this)}},{key:"createFilter",value:function(){this.options.filter&&this.options.filter.show&&(this.filter=new v.Filter(this))}},{key:"loadPosts",value:function(t){this.feed.loadPosts(t)}},{key:"createPostElements",value:function(t){var i=this,s=[];return e(t).each(function(){var t=i.createPostElement(this);s.push(t.$el)}),s}},{key:"createPostElement",value:function(t){var i=new v.Post(t,this.options,this);return e(i).bind("postClick",this.onPostClick.bind(this)),e(i).bind("postReadMoreClick",this.onPostClick.bind(this)),this.options.onPostCreated&&this.options.onPostCreated(i),i}},{key:"onPostsLoaded",value:function(t){v.log("Client->onPostsLoaded"),v.log(t.target)}},{key:"onPostsFail",value:function(t){v.log("Client->onPostsLoadedFail"),v.log(t.target)}},{key:"onPostClick",value:function(t,e){this.popupManager.showPopup(e)}},{key:"track",value:function(t){v.log("Feed->track "+t),e.ajax({url:this.getUrl("/track/"+this.options.feedId),dataType:"json",data:{a:t},success:function(t){v.log("Feed->track success"),v.log(t)},error:function(t,e,i){v.log("Feed->_loadPosts fail"),v.log(e),v.log(i)}})}},{key:"getUrl",value:function(t){return this.options.apiEndpoint+t}}]),t}();v.Client=y,e.support.cors=!0;var k=function(t){function n(t){o(this,n);var e=i(this,(n.__proto__||Object.getPrototypeOf(n)).call(this));return v.log("Feed->init with options"),e.client=t,e.posts=[],e.currentPage=0,e.postsLoaded=0,e.postCount=0,e.loading=!1,e.options=e.client.options,e.feedBase=e.options.apiEndpoint+"/feed",e}return s(n,t),a(n,[{key:"loadPosts",value:function(t,i){if(t=t||0,v.log("Feed->loadPosts "+this.loading),this.loading)return!1;this.currentPage=t;var s=e.extend({},this.options.feedParams,i);s.limit=this.options.postsPerPage,s.offset=t*this.options.postsPerPage,this._loadPosts(s)}},{key:"loadMore",value:function(t){if(v.log("Feed->loadMore "+this.loading),this.loading)return!1;var i={limit:this.options.postsPerPage};e.extend(i,this.options.feedParams,t),i.offset=this.posts.length,this._loadPosts(i)}},{key:"_loadPosts",value:function(t){var i=this;v.log("Feed->_loadPosts"),this.loading=!0,e.ajax({url:this.getUrl("/posts"),dataType:"json",data:t,success:function(t){v.log("Feed->_loadPosts success"),t.success?(i.postCount=t.postCount,i.postsLoaded+=t.posts.length,i.posts=i.posts.concat(t.posts),i.networks=t.networks,i.trigger("postsLoaded",t.posts)):i.trigger("postsFailed",t.posts),i.loading=!1},error:function(t,e,s){v.log("Feed->_loadPosts fail"),v.log(e),v.log(s),i.trigger("postsFailed",[]),i.loading=!1}})}},{key:"loadPost",value:function(t,i,s){s=s||function(){},e.get(this.getUrl("/post/"+t),{},function(t){t.success?i(t.post):s()})}},{key:"inappropriatePost",value:function(t,i,s,o){var n={reason:i};e.post(this.getUrl("/post/"+t+"/inappropriate"),n,function(t,i,n){t=e.parseJSON(t),t.success===!0?s():o(n)})}},{key:"lovePost",value:function(t,i,s){var o={};e.post(this.getUrl("/post/"+t+"/love"),o,function(t,o,n){t=e.parseJSON(t),t.success===!0?i(t.loves):s(n)})}},{key:"getUrl",value:function(t){return this.feedBase+"/"+this.options.feedId+t}}]),n}(m);v.Feed=k,v.Templates.filterTemplate=' <div class="crt-filter"> <div class="crt-filter-network"><label>Show:</label> <ul class="networks"></ul></div> </div>';var P=function(){function t(i){var s=this;o(this,t),v.log("Filter->construct"),this.client=i,this.$filter=v.Template.render("#filterTemplate",{}),this.$filterNetworks=this.$filter.find(".networks"),this.client.$container.append(this.$filter),this.$filter.find(".crt-filter-network label").text(this.client.options.filter.label),this.$filter.on("click",".crt-filter-network a",function(t){t.preventDefault(),console.log(t);var i=e(t.target),o=i.data("network");s.$filter.find(".crt-filter-network li").removeClass("active"),i.parent().addClass("active"),v.EventBus.trigger("crt:filter:change"),o?s.client.feed.loadPosts(0,{network_id:o}):s.client.feed.loadPosts(0,{})}),this.client.feed.on("postsLoaded",function(t){s.onPostsLoaded(t.target)})}return a(t,[{key:"onPostsLoaded",value:function(){if(console.log("Asd"),!this.filtersLoaded){this.$filterNetworks.append('<li class="active"><a href="#" data-network="0"> All</a></li>');var t=!0,e=!1,i=void 0;try{for(var s,o=this.client.feed.networks[Symbol.iterator]();!(t=(s=o.next()).done);t=!0){var n=s.value,a=v.Networks[n];console.log(a),this.$filterNetworks.append('<li><a href="#" data-network="'+n+'"><i class="'+a.icon+'"></i> '+a.name+"</a></li>")}}catch(t){e=!0,i=t}finally{try{!t&&o.return&&o.return()}finally{if(e)throw i}}this.filtersLoaded=!0}}}]),t}();v.Filter=P,v.Networks={1:{name:"Twitter",icon:"crt-icon-twitter"},2:{name:"Instagram",icon:"crt-icon-instagram"},3:{name:"Facebook",icon:"crt-icon-facebook"},4:{name:"Pinterest",icon:"crt-icon-pinterest"},5:{name:"Google",icon:"crt-icon-google"},6:{name:"Vine",icon:"crt-icon-vine"},7:{name:"Flickr",icon:"crt-icon-flickr"},8:{name:"Youtube",icon:"crt-icon-youtube"},9:{name:"Tumblr",icon:"crt-icon-tumblr"},10:{name:"RSS",icon:"crt-icon-rss"},11:{name:"LinkedIn",icon:"crt-icon-linkedin"}},v.PopupInappropriate=function(t,e){this.init(t,e)},e.extend(v.PopupInappropriate.prototype,{feed:null,post:null,init:function(t,i){var s=this;this.feed=i,this.post=t,this.jQueryel=e(".mark-bubble"),e(".mark-close").click(function(t){t.preventDefault(),e(this).parent().fadeOut("slow")}),e(".mark-bubble .submit").click(function(){var t=s.$el.find("input.text"),o=e.trim(t.val());o&&(t.disabled=!0,e(this).hide(),s.$el.find(".waiting").show(),i.inappropriatePost(s.post.id,o,function(){t.val(""),s.$el.find(".waiting").hide(),s.$el.find(".title").html("Thank you"),s.$el.find("input.text").hide(),s.$el.find("input.text").html(""),s.$el.find(".success-message").html("This message has been marked as inappropriate").show()},function(){s.$el.find(".waiting").hide(),s.$el.find(".title").html("Oops"),s.$el.find("input.text").hide(),s.$el.find("input.text").html(""),s.$el.find(".success-message").html("It looks like a problem has occurred. Please try again later").show()}))}),this.$el.fadeIn("slow")}});var $=function(){function t(i){o(this,t),v.log("PopupManager->init "),this.client=i,this.templateId="#popup-wrapper-template",this.$wrapper=v.Template.render(this.templateId,{}),this.$popupContainer=this.$wrapper.find(".crt-popup-container"),this.$underlay=this.$wrapper.find(".crt-popup-underlay"),e("body").append(this.$wrapper),this.$underlay.click(this.onUnderlayClick.bind(this))}return a(t,[{key:"showPopup",value:function(t){var e=this;this.popup?this.popup.hide(function(){e.popup.destroy(),e.showPopup2(t)}):this.showPopup2(t)}},{key:"showPopup2",value:function(t){this.popup=new v.Popup(this,t,this.feed),this.$popupContainer.append(this.popup.$popup),this.$wrapper.show(),"block"!==this.$underlay.css("display")&&this.$underlay.fadeIn(),this.popup.show(),e("body").addClass("crt-popup-visible"),this.currentPostNum=0;for(var i=0;i<this.posts.length;i++)if(t.json.id==this.posts[i].id){this.currentPostNum=i,v.log("Found post "+i);break}this.client.track("popup:show")}},{key:"setPosts",value:function(t){this.posts=t}},{key:"onClose",value:function(){this.hide()}},{key:"onPrevious",value:function(){this.currentPostNum-=1,this.currentPostNum=this.currentPostNum>=0?this.currentPostNum:this.posts.length-1,this.showPopup({json:this.posts[this.currentPostNum]})}},{key:"onNext",value:function(){this.currentPostNum+=1,this.currentPostNum=this.currentPostNum<this.posts.length?this.currentPostNum:0,this.showPopup({json:this.posts[this.currentPostNum]})}},{key:"onUnderlayClick",value:function(t){v.log("PopupManager->onUnderlayClick"),t.preventDefault(),this.popup.hide(function(){this.hide()}.bind(this))}},{key:"hide",value:function(){var t=this;v.log("PopupManager->hide"),this.client.track("popup:hide"),e("body").removeClass("crt-popup-visible"),this.currentPostNum=0,this.popup=null,this.$underlay.fadeOut(function(){t.$underlay.css({display:"",opacity:""}),t.$wrapper.hide()})}},{key:"destroy",value:function(){this.$underlay.remove(),delete this.$popup,delete this.$underlay}}]),t}();v.PopupManager=$;var b=function(){function t(e,i,s){if(o(this,t),v.log("Popup->init "),this.popupManager=e,this.json=i.json,this.feed=s,this.templateId="#popup-template",this.videoPlaying=!1,this.$popup=v.Template.render(this.templateId,this.json),this.json.image&&this.$popup.addClass("has-image"),this.json.video&&this.$popup.addClass("has-video"),this.json.video&&this.json.video.indexOf("youtu")>=0){this.$popup.find("video").remove();var n=v.StringUtils.youtubeVideoId(this.json.video),a='<iframe id="ytplayer" type="text/html" width="615" height="615"             src="https://www.youtube.com/embed/'+n+'?autoplay=0&rel=0&showinfo"             frameborder="0"></iframe>';this.$popup.find(".crt-video-container img").remove(),this.$popup.find(".crt-video-container a").remove(),this.$popup.find(".crt-video-container").append(a)}this.$popup.on("click"," .crt-close",this.onClose.bind(this)),this.$popup.on("click"," .crt-previous",this.onPrevious.bind(this)),this.$popup.on("click"," .crt-next",this.onNext.bind(this)),this.$popup.on("click"," .crt-play",this.onPlay.bind(this)),this.$popup.on("click",".crt-share-facebook",this.onShareFacebookClick.bind(this)),this.$popup.on("click",".crt-share-twitter",this.onShareTwitterClick.bind(this))}return a(t,[{key:"onShareFacebookClick",value:function(t){return t.preventDefault(),v.SocialFacebook.share(this.json),this.widget.track("share:facebook"),!1}},{key:"onShareTwitterClick",value:function(t){return t.preventDefault(),v.SocialTwitter.share(this.json),this.widget.track("share:twitter"),!1}},{key:"onClose",value:function(t){t.preventDefault();var e=this;this.hide(function(){e.popupManager.onClose()})}},{key:"onPrevious",value:function(t){t.preventDefault(),this.popupManager.onPrevious()}},{key:"onNext",value:function(t){t.preventDefault(),this.popupManager.onNext()}},{key:"onPlay",value:function(t){v.log("Popup->onPlay"),t.preventDefault(),this.videoPlaying=!this.videoPlaying,this.videoPlaying?(this.$popup.find("video")[0].play(),this.popupManager.client.track("video:play")):(this.$popup.find("video")[0].pause(),this.popupManager.client.track("video:pause")),v.log(this.videoPlaying),this.$popup.toggleClass("video-playing",this.videoPlaying)}},{key:"show",value:function(){this.$popup.fadeIn(function(){})}},{key:"hide",value:function(t){v.log("Popup->hide");var e=this;this.$popup.fadeOut(function(){e.destroy(),t()})}},{key:"destroy",value:function(){this.$popup&&this.$popup.length&&(this.$popup.remove(),this.$popup.find("video").length&&this.$popup.find("video")[0].pause()),delete this.$popup}}]),t}();v.Popup=b;var C=function(){function t(e,i,s){var n=this;if(o(this,t),this.options=i,this.widget=s,this.templateId=this.options.postTemplate,this.json=e,this.$el=v.Template.render(this.templateId,e),this.$el.find(".crt-share-facebook").click(this.onShareFacebookClick.bind(this)),this.$el.find(".crt-share-twitter").click(this.onShareTwitterClick.bind(this)),this.$el.find(".crt-post-read-more-button").click(this.onReadMoreClick.bind(this)),this.$el.click(this.onPostClick.bind(this)),this.$post=this.$el.find(".crt-post"),this.$image=this.$el.find(".crt-post-image"),this.$imageContainer=this.$el.find(".crt-image-c"),this.$image.css({opacity:0}),this.json.image?(this.$image.on("load",this.onImageLoaded.bind(this)),this.$image.on("error",this.onImageError.bind(this))):setTimeout(function(){
console.log("asdasd"),n.setHeight()},100),this.json.image_width>0){var a=this.json.image_height/this.json.image_width*100;this.$imageContainer.addClass("crt-image-responsive").css("padding-bottom",a+"%")}this.$image.data("dims",this.json.image_width+":"+this.json.image_height),this.$post=this.$el.find(".crt-post"),this.json.video&&this.$post.addClass("has-video")}return a(t,[{key:"onShareFacebookClick",value:function(t){return t.preventDefault(),v.SocialFacebook.share(this.json),this.widget.track("share:facebook"),!1}},{key:"onShareTwitterClick",value:function(t){return t.preventDefault(),v.SocialTwitter.share(this.json),this.widget.track("share:twitter"),!1}},{key:"onPostClick",value:function(t){var i=e(t.target);i.is("a")&&"#"!==i.attr("href")?this.widget.track("click:link"):(t.preventDefault(),e(this).trigger("postClick",this,this.json,t))}},{key:"onImageLoaded",value:function(){this.$image.animate({opacity:1}),this.setHeight()}},{key:"onImageError",value:function(){this.$image.hide(),this.setHeight()}},{key:"setHeight",value:function(){var t=this.$post.height();console.log(t),this.options.maxHeight&&this.options.maxHeight>0&&t>this.options.maxHeight&&this.$post.css({maxHeight:this.options.maxHeight}).addClass("crt-post-max-height")}},{key:"onReadMoreClick",value:function(t){t.preventDefault(),this.widget.track("click:read-more"),e(this).trigger("postReadMoreClick",this,this.json,t)}}]),t}();v.Post=C,v.SocialFacebook={share:function(t){var e=t;e.url=v.Utils.postUrl(t);var i=function(){},s=!1;if(s)window.FB.ui({method:"feed",link:e.url,picture:e.image,name:e.user_screen_name,description:e.text},i);else{var o="https://www.facebook.com/sharer/sharer.php?u={{url}}&d={{text}}",n=v.Utils.tinyparser(o,e);v.Utils.popup(n,"twitter","600","430","0")}}},v.SocialPinterest={share:function(t){var e=t;e.url=v.Utils.postUrl(t);var i="http://pinterest.com/pin/create/button/?url={{url}}&media={{image}}&description={{text}}";v.Utils.popup(v.Utils.tinyparser(i,e),"pintrest","600","270","0")}},v.SocialTwitter={share:function(t){var e=t;e.url=v.Utils.postUrl(t);var i="http://twitter.com/share?url={{url}}&text={{text}}&hashtags={{hashtags}}",s=v.Utils.tinyparser(i,e);v.Utils.popup(s,"twitter","600","430","0")}},v.Templates.postTemplate=' <div class="crt-post-c">    <div class="crt-post-bg"></div>     <div class="crt-post post<%=id%> crt-post-<%=this.networkIcon()%>">         <div class="crt-post-header">             <span class="crt-social-icon"><i class="crt-icon-<%=this.networkIcon()%>"></i></span>             <img src="<%=user_image%>"  />             <div class="crt-post-name">            <div class="crt-post-fullname"><%=user_full_name%></div>            <div class="crt-post-username"><a href="<%=this.userUrl()%>" target="_blank">@<%=user_screen_name%></a></div>            </div>         </div>         <div class="crt-post-content">             <div class="crt-image crt-hitarea crt-post-content-image <%=this.contentImageClasses()%>" >                 <div class="crt-image-c"><img src="<%=image%>" class="crt-post-image" /></div>                 <span class="crt-play"><i class="crt-play-icon"></i></span>             </div>             <div class="text crt-post-content-text <%=this.contentTextClasses()%>">                 <div class="crt-post-text-body"><%=this.parseText(text)%></div>             </div>         </div>         <div class="crt-post-footer">            <div class="crt-date"><%=this.prettyDate(source_created_at)%></div>             <div class="crt-post-share"><span class="ctr-share-hint"></span><a href="#" class="crt-share-facebook"><i class="crt-icon-facebook"></i></a>  <a href="#" class="crt-share-twitter"><i class="crt-icon-twitter"></i></a></div>        </div>         <div class="crt-post-read-more"><a href="#" class="crt-post-read-more-button">Read more</a> </div>     </div></div>',v.Templates.popupWrapperTemplate=' <div class="crt-popup-wrapper">     <div class="crt-popup-wrapper-c">         <div class="crt-popup-underlay"></div>         <div class="crt-popup-container"></div>     </div> </div>',v.Templates.popupTemplate=' <div class="crt-popup">     <a href="#" class="crt-close crt-icon-cancel"></a>     <a href="#" class="crt-next crt-icon-right-open"></a>     <a href="#" class="crt-previous crt-icon-left-open"></a>     <div class="crt-popup-left">          <div class="crt-video">             <div class="crt-video-container">                <video preload="none">                <source src="<%=video%>" type="video/mp4" >                </video>                <img src="<%=image%>" />                <a href="javascript:;" class="crt-play"><i class="crt-play-icon"></i></a>             </div>         </div>         <div class="crt-image">             <img src="<%=image%>" />         </div>     </div>     <div class="crt-popup-right">         <div class="crt-popup-header">             <span class="crt-social-icon"><i class="crt-icon-<%=this.networkIcon()%>"></i></span>             <img src="<%=user_image%>"  />             <div class="crt-post-name"><span><%=user_full_name%></span><br/><a href="<%=this.userUrl()%>" target="_blank">@<%=user_screen_name%></a></div>         </div>         <div class="crt-popup-text <%=this.contentTextClasses()%>">             <div class="crt-popup-text-container">                 <p class="crt-date"><%=this.prettyDate(source_created_at)%></p>                 <div class="crt-popup-text-body"><%=this.parseText(text)%></div>             </div>         </div>         <div class="crt-popup-footer">            <div class="crt-post-share"><span class="ctr-share-hint"></span><a href="#" class="crt-share-facebook"><i class="crt-icon-facebook"></i></a>  <a href="#" class="crt-share-twitter"><i class="crt-icon-twitter"></i></a></div>        </div>     </div> </div>',v.Templates.popupUnderlayTemplate="",v.Template={camelize:function(t){return t.replace(/(?:^|[-_])(\w)/g,function(t,e){return e?e.toUpperCase():""})},render:function(t,i){var s=this.camelize(t).substring(1),o="";if(void 0!==v.Templates[s]?o=v.Templates[s]:1===e(t).length&&(o=e(t).html()),""===o)throw new Error("could not find template "+t+"("+s+")");var n=window.parseTemplate(o,i);return e.parseHTML&&(n=e.parseHTML(n)),e(n).filter("div")}},v.Track={track:function(t){e.ajax({url:this.getUrl("/posts"),dataType:"json",data:params,success:function(t){v.log("Feed->_loadPosts success"),t.success?(that.postCount=t.postCount,that.postsLoaded+=t.posts.length,that.posts=that.posts.concat(t.posts),that.options.onPostsLoaded&&that.options.onPostsLoaded(t.posts)):that.options.onPostsFail&&that.options.onPostsFail(t),that.loading=!1},error:function(t,e,i){v.log("Feed->_loadPosts fail"),v.log(e),v.log(i),that.options.onPostsFail&&that.options.onPostsFail(),that.loading=!1}})},getUrl:function(t){return this.feedBase+"/"+this.options.feedId+t}},v.Utils={postUrl:function(t){return console.log(t.url),t.url&&""!==t.url&&"''"!==t.url?t.url:(console.log(t.url),t.network_id+""=="1"?"https://twitter.com/"+t.user_screen_name+"/status/"+t.source_identifier:"")},center:function(t,e,i){var s=window.screen,o=i||{},n=o.height||s.height,a=o.width||s.height,r=t,l=e;return{top:n?(n-l)/2:0,left:a?(a-r)/2:0}},popup:function(t,e,i,s,o){var n=this.center(i,s),a="height="+s+",width="+i+",top="+n.top+",left="+n.left+",scrollbars="+o+",resizable";window.open(t,e,a)},tinyparser:function(t,e){return t.replace(/\{\{(.*?)\}\}/g,function(t,i){return e&&"undefined"!=typeof e[i]?encodeURIComponent(e[i]):""})}},v.DateUtils={dateFromString:function(t){dtstr=t.replace(/\D/g," ");var e=dtstr.split(" ");e[1]--;var i=new Date(Date.UTC(e[0],e[1],e[2],e[3],e[4],e[5]));return i},dateAsDayMonthYear:function(t){var e=new Date(parseInt(t,10)),i=e.getDate()+"",s=e.getMonth()+1+"",o=e.getFullYear()+"";i=1===i.length?"0"+i:i,s=1===s.length?"0"+s:s;var n=i+"/"+s+"/"+o;return n},dateAsTimeArray:function(t){var e=new Date(parseInt(t,10)),i=e.getHours()+"",s=e.getMinutes()+"",o=void 0;i>=12?(o="PM",i>12&&(i=i-12+"")):o="AM",i=1===i.length?"0"+i:i,s=1===s.length?"0"+s:s;var n=[parseInt(i.charAt(0),10),parseInt(i.charAt(1),10),parseInt(s.charAt(0),10),parseInt(s.charAt(1),10),o];return n}},v.StringUtils={twitterLinks:function(t){return t=t.replace(/[@]+[A-Za-z0-9-_]+/g,function(t){var e=t.replace("@","");return v.StringUtils.url("https://twitter.com/"+e,t)}),t=t.replace(/[#]+[A-Za-z0-9-_]+/g,function(t){var e=t.replace("#","%23");return v.StringUtils.url("https://twitter.com/search?q="+e,t)})},instagramLinks:function(t){return t=t.replace(/[@]+[A-Za-z0-9-_]+/g,function(t){var e=t.replace("@","");return v.StringUtils.url("https://www.instagram.com/"+e+"/",t)}),t=t.replace(/[#]+[A-Za-z0-9-_]+/g,function(t){var e=t.replace("#","");return v.StringUtils.url("https://www.instagram.com/explore/tags/"+e+"/",t)})},facebookLinks:function(t){return t=t.replace(/[@]+[A-Za-z0-9-_]+/g,function(t){var e=t.replace("@","");return v.StringUtils.url("https://www.facebook.com/"+e+"/",t)}),t=t.replace(/[#]+[A-Za-z0-9-_]+/g,function(t){var e=t.replace("#","%23");return v.StringUtils.url("https://www.facebook.com/search/top/?q="+e,t)})},linksToHref:function(t){return t=t.replace(/[A-Za-z]+:\/\/[A-Za-z0-9-_]+\.[A-Za-z0-9-_:%&~\?\/.=]+/g,function(t){return v.StringUtils.url(t)})},url:function(t,e){return e=e||t,'<a href="'+t+'" target="_blank">'+e+"</a>"},youtubeVideoId:function(t){var e=/^.*((youtu.be\/)|(v\/)|(\/u\/\w\/)|(embed\/)|(watch\?))\??v?=?([^#\&\?]*).*/,i=t.match(e);return!(!i||11!=i[7].length)&&i[7]}},v.Config.Waterfall=e.extend({},v.Config.Defaults,{scroll:"more",waterfall:{gridWidth:250,animate:!0,animateSpeed:400}});var _=function(t){function n(t){o(this,n);var s=i(this,(n.__proto__||Object.getPrototypeOf(n)).call(this));return s.setOptions(t,v.Config.Waterfall),v.log("Waterfall->init with options:"),v.log(s.options),s.init(s)&&(s.$scroll=e('<div class="crt-feed-scroll"></div>').appendTo(s.$container),s.$feed=e('<div class="crt-feed"></div>').appendTo(s.$scroll),s.$container.addClass("crt-feed-container"),"continuous"==s.options.scroll?e(s.$scroll).scroll(function(){var t=s.$scroll.height(),e=s.$feed.height(),i=s.$scroll.scrollTop();i>=e-t&&s.loadMorePosts()}):"none"==s.options.scroll||(s.$more=e('<div class="crt-feed-more"><a href="#"><span>Load more</span></a></div>').appendTo(s.$scroll),s.$more.find("a").on("click",function(t){t.preventDefault(),s.loadMorePosts()})),s.$feed.waterfall({selector:".crt-post-c",gutter:0,width:s.options.waterfall.gridWidth,animate:s.options.waterfall.animate,animationOptions:{speed:s.options.waterfall.animateSpeed/2,duration:s.options.waterfall.animateSpeed}}),v.EventBus.on("crt:filter:change",function(t){s.$feed.find(".crt-post-c").remove()}),s.loadPosts(0)),s}return s(n,t),a(n,[{key:"loadPosts",value:function(t,e){v.log("Waterfall->loadPage"),e&&this.$feed.find(".crt-post-c").remove(),this.feed.loadPosts(t)}},{key:"loadMorePosts",value:function(){v.log("Waterfall->loadMorePosts"),this.feed.loadPosts(this.feed.currentPage+1)}},{key:"onPostsLoaded",value:function(t){v.log("Waterfall->onPostsLoaded"),v.log(t);var i=this.createPostElements(t);this.$feed.waterfall("append",i);var s=this;e.each(i,function(t){var e=this;s.options.waterfall.showReadMore&&e.find(".crt-post").addClass("crt-post-show-read-more")}),this.popupManager.setPosts(t),this.loading=!1,this.options.onPostsLoaded(this,t)}},{key:"onPostsFailed",value:function(t){this.loading=!1,this.$feed.html('<p style="text-align: center">'+t.message+"</p>")}},{key:"destroy",value:function(){this.$feed.remove(),this.$scroll.remove(),this.$more&&this.$more.remove(),this.$container.removeClass("crt-feed-container"),delete this.$feed,delete this.$scroll,delete this.$container,delete this.options,delete this.totalPostsLoaded,delete this.loading,delete this.allLoaded,delete this.feed}}]),n}(v.Client);v.Waterfall=_,v.Config.Carousel=e.extend({},v.Config.Defaults,{scroll:"more",carousel:{autoPlay:!0,autoLoad:!0}});var x=function(t){function n(t){o(this,n);var s=i(this,(n.__proto__||Object.getPrototypeOf(n)).call(this));if(s.setOptions(t,v.Config.Carousel),s.containerHeight=0,s.loading=!1,s.posts=[],s.firstLoad=!0,v.log("Carousel->init with options:"),v.log(s.options),s.init(s)){s.allLoaded=!1;var a=s;s.$feed=e('<div class="crt-feed"></div>').appendTo(s.$container),s.$container.addClass("crt-carousel"),s.carousel=new window.CCarousel(s.$feed,s.options.carousel),s.$feed.on("curatorCarousel:changed",function(t,e,i){console.log("curatorCarousel:changed "+i),a.options.carousel.autoLoad&&a.loadMorePosts()}),s.loadPosts(0)}return s}return s(n,t),a(n,[{key:"loadMorePosts",value:function(){v.log("Carousel->loadMorePosts"),this.feed.postCount>this.feed.postsLoaded&&this.feed.loadPosts(this.feed.currentPage+1)}},{key:"onPostsLoaded",value:function(t){if(v.log("Carousel->onPostsLoaded"),this.loading=!1,0===t.length)this.allLoaded=!0;else{var i=this,s=[];e(t).each(function(t){var e=i.createPostElement(this);s.push(e.$el),i.options.animate&&i.firstLoad&&(e.$el.css({opacity:0}),setTimeout(function(){console.log(t),e.$el.css({opacity:0}).animate({opacity:1})},100*t))}),this.carousel.add(s),this.carousel.update(),this.popupManager.setPosts(t),this.options.onPostsLoaded(this,t)}this.firstLoad=!1}},{key:"onPostsFail",value:function(t){v.log("Carousel->onPostsFail"),this.loading=!1,this.$feed.html('<p style="text-align: center">'+t.message+"</p>")}},{key:"destroy",value:function(){this.carousel.destroy(),this.$feed.remove(),this.$container.removeClass("crt-carousel"),delete this.$feed,delete this.$container,delete this.options,delete this.feed.postsLoaded,delete this.loading,delete this.allLoaded,delete this.feed}}]),n}(y);v.Carousel=x,v.Config.Panel=e.extend({},v.Config.Defaults,{panel:{autoPlay:!0,autoLoad:!0,moveAmount:1,fixedHeight:!1,infinite:!0,minWidth:2e3}});var T=function(t){function n(t){o(this,n);var s=i(this,(n.__proto__||Object.getPrototypeOf(n)).call(this));return s.setOptions(t,v.Config.Panel),v.log("Panel->init with options:"),v.log(s.options),s.containerHeight=0,s.loading=!1,s.feed=null,s.$container=null,s.$feed=null,s.posts=[],s.init(s)&&(s.allLoaded=!1,s.$feed=e('<div class="crt-feed"></div>').appendTo(s.$container),s.$container.addClass("crt-panel"),s.options.panel.fixedHeight&&s.$container.addClass("crt-panel-fixed-height"),s.$feed.curatorCarousel(s.options.panel),s.$feed.on("curatorCarousel:changed",function(t,e,i){!s.allLoaded&&s.options.panel.autoLoad&&i>=s.feed.postsLoaded-4&&s.loadMorePosts()}),s.loadPosts(0)),s}return s(n,t),a(n,[{key:"loadMorePosts",value:function(){v.log("Carousel->loadMorePosts"),this.feed.loadPosts(this.feed.currentPage+1)}},{key:"onPostsLoaded",value:function(t){if(v.log("Carousel->onPostsLoaded"),this.loading=!1,0===t.length)this.allLoaded=!0;else{var i=this,s=[];e(t).each(function(){var t=i.createPostElement(this);s.push(t.$el)}),i.$feed.curatorCarousel("add",s),i.$feed.curatorCarousel("update"),this.popupManager.setPosts(t),this.options.onPostsLoaded(this,t)}}},{key:"onPostsFail",value:function(t){v.log("Carousel->onPostsFail"),this.loading=!1,this.$feed.html('<p style="text-align: center">'+t.message+"</p>")}},{key:"destroy",value:function(){this.$feed.curatorCarousel("destroy"),this.$feed.remove(),this.$container.removeClass("crt-panel"),delete this.$feed,delete this.$container,delete this.options,delete this.feed.postsLoaded,delete this.loading,delete this.allLoaded,delete this.feed}}]),n}(v.Client);v.Panel=T,v.Config.Grid=e.extend({},v.Config.Defaults,{postTemplate:"#gridPostTemplate",grid:{minWidth:200,rows:3}}),v.Templates.gridPostTemplate=' <div class="crt-post-c">    <div class="crt-post post<%=id%> <%=this.contentImageClasses()%> <%=this.contentTextClasses()%>">         <div class="crt-post-content">             <div class="crt-hitarea" >                 <img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" class="spacer" />                 <div class="crt-post-content-image" style="background-image: url(<%=image%>);"> </div>                 <div class="crt-post-content-text-c">                     <div class="crt-post-content-text">                         <%=this.parseText(text)%>                     </div>                 </div>                 <a href="javascript:;" class="crt-play"><i class="crt-play-icon"></i></a>                 <span class="crt-social-icon crt-social-icon-normal"><i class="crt-icon-<%=this.networkIcon()%>"></i></span>                 <div class="crt-post-hover">                    <div class="crt-post-header">                         <img src="<%=user_image%>"  />                         <div class="crt-post-name"><span><%=user_full_name%></span><br/><a href="<%=this.userUrl()%>" target="_blank">@<%=user_screen_name%></a></div>                     </div>                     <div class="crt-post-hover-text">                         <%=this.parseText(text)%>                     </div>                     <span class="crt-social-icon crt-social-icon-hover"><i class="crt-icon-<%=this.networkIcon()%>"></i></span>                 </div>             </div>         </div>     </div></div>',v.Templates.gridFeedTemplate=' <div class="crt-feed-window">    <div class="crt-feed"></div></div><div class="crt-feed-more"><a href="#">Load more</a></div>';var L=function(t){function n(t){o(this,n);var s=i(this,(n.__proto__||Object.getPrototypeOf(n)).call(this));if(s.setOptions(t,v.Config.Grid),v.log("Grid->init with options:"),v.log(s.options),s.containerHeight=0,s.loading=!1,s.feed=null,s.$container=null,s.$feed=null,s.posts=[],s.totalPostsLoaded=0,s.allLoaded=!1,s.previousCol=0,s.page=0,s.rowsShowing=0,s.init(s)){var a=v.Template.render("#gridFeedTemplate",{});s.$container.append(a),s.$feed=s.$container.find(".crt-feed"),s.$feedWindow=s.$container.find(".crt-feed-window"),s.$loadMore=s.$container.find(".crt-feed-more a"),s.$container.addClass("crt-grid");var r=Math.floor(s.$container.width()/s.options.grid.minWidth),l=r*(s.options.grid.rows+1);s.options.grid.showLoadMore?(s.$feedWindow.css({position:"relative"}),s.$loadMore.click(s.onMoreClicked.bind(s))):s.$loadMore.hide(),s.rowsShowing=s.options.grid.rows,s.feed.options.postsPerPage=l,s.loadPosts(0)}var c=null,h=s;return e(window).resize(function(){clearTimeout(c),c=setTimeout(function(){h.updateLayout()},100)}),s.updateLayout(),e(window).on("curatorCssLoaded",function(){clearTimeout(c),c=setTimeout(function(){h.updateLayout()},100)}),e(document).on("ready",function(){clearTimeout(c),c=setTimeout(function(){h.updateLayout()},100)}),s}return s(n,t),a(n,[{key:"onPostsLoaded",value:function(t){if(v.log("Grid->onPostsLoaded"),this.loading=!1,0===t.length)this.allLoaded=!0;else{var i=this,s=[];e(t).each(function(t){var e=i.createPostElement.call(i,this);s.push(e.$el),i.$feed.append(e.$el),i.options.animate&&(e.$el.css({opacity:0}),setTimeout(function(){e.$el.css({opacity:0}).animate({opacity:1})},100*t))}),this.popupManager.setPosts(t),this.options.onPostsLoaded(this,t),this.updateHeight()}}},{key:"createPostElement",value:function(t){var i=new v.Post(t,this.options);return e(i).bind("postClick",e.proxy(this.onPostClick,this)),this.options.onPostCreated&&this.options.onPostCreated(i),i}},{key:"onPostsFailed",value:function(t){v.log("Grid->onPostsFailed"),this.loading=!1,this.$feed.html('<p style="text-align: center">'+t.message+"</p>")}},{key:"onPostClick",value:function(t,e){this.popupManager.showPopup(e)}},{key:"onMoreClicked",value:function(t){t.preventDefault(),this.rowsShowing=this.rowsShowing+this.options.grid.rows,this.updateHeight(!0),this.feed.loadMore()}},{key:"updateLayout",value:function(){var t=Math.floor(this.$container.width()/this.options.grid.minWidth),e=t*this.options.grid.rows;this.$container.removeClass("crt-grid-col"+this.previousCol),this.previousCol=t,this.$container.addClass("crt-grid-col"+this.previousCol),e>this.feed.postsLoaded&&this.loadPosts(this.feed.currentPage+1),this.updateHeight()}},{key:"updateHeight",value:function(t){var e=this.$container.find(".crt-post-c").width();this.$feedWindow.css({overflow:"hidden"});var i=Math.ceil(this.feed.postCount/this.previousCol),s=this.rowsShowing<i?this.rowsShowing:i;t?this.$feedWindow.animate({height:s*e}):this.$feedWindow.height(s*e),this.options.grid.showLoadMore&&(this.rowsShowing>=i?this.$loadMore.hide():this.$loadMore.show())}},{key:"destroy",value:function(){this.$container.empty().removeClass("crt-grid").removeClass("crt-grid-col"+this.previousCol).css({height:"",overflow:""}),delete this.$feed,delete this.$container,delete this.options,delete this.totalPostsLoaded,delete this.loading,delete this.allLoaded,delete this.feed}}]),n}(y);v.Grid=L;var S={feedId:"",postsPerPage:12,maxPosts:0,apiEndpoint:"https://api.curator.io/v1",onPostsLoaded:function(){}};return v.Custom=v.augment.extend(v.Client,{containerHeight:0,loading:!1,feed:null,$container:null,$feed:null,posts:[],totalPostsLoaded:0,allLoaded:!1,constructor:function(t){this.uber.setOptions.call(this,t,S),v.log("Panel->init with options:"),v.log(this.options),this.uber.init.call(this)&&(this.$feed=e('<div class="crt-feed"></div>').appendTo(this.$container),this.$container.addClass("crt-custom"),this.loadPosts(0))},onPostsLoaded:function(t){if(v.log("Custom->onPostsLoaded"),this.loading=!1,0===t.length)this.allLoaded=!0;else{var i=this,s=[];e(t).each(function(){var t=i.createPostElement(this);s.push(t.$el),i.$feed.append(t.$el)}),this.popupManager.setPosts(t),this.options.onPostsLoaded(this,t)}},onPostsFailed:function(t){v.log("Custom->onPostsFailed"),this.loading=!1,this.$feed.html('<p style="text-align: center">'+t.message+"</p>")},onPostClick:function(t,e){this.popupManager.showPopup(e)},destroy:function(){this.$feed.remove(),this.$container.removeClass("crt-custom"),delete this.$feed,delete this.$container,delete this.options,delete this.totalPostsLoaded,delete this.loading,delete this.allLoaded,delete this.feed}}),v});